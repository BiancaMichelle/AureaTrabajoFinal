<!DOCTYPE html>
<html lang="es" xmlns:th="http://www.thymeleaf.org" th:replace="~{layout/adminBase :: layout(~{::title}, ~{::main})}">
<head>
    <title>Gestión de Ofertas Académicas</title>
    <style>
        /* Estilos para el modal de error */
        .error-content {
            display: flex;
            align-items: flex-start;
            gap: 1rem;
            margin-bottom: 1rem;
        }
        
        .error-icon {
            font-size: 2rem;
            color: #ffc107;
            margin-top: 0.2rem;
        }
        
        .error-message h4 {
            color: #dc3545;
            margin: 0 0 0.5rem 0;
            font-size: 1.2rem;
        }
        
        .error-message p {
            margin: 0 0 1rem 0;
            line-height: 1.5;
            color: #333;
        }
        
        .error-suggestions {
            background: #f8f9fa;
            border-left: 4px solid #ffc107;
            padding: 1rem;
            border-radius: 0.375rem;
            margin-top: 1rem;
        }
        
        .error-suggestions h5 {
            color: #856404;
            margin: 0 0 0.5rem 0;
            font-size: 1rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }
        
        .error-suggestions ul {
            margin: 0;
            padding-left: 1rem;
        }
        
        .error-suggestions li {
            margin-bottom: 0.5rem;
            color: #495057;
        }
        
        .error-suggestions li i {
            color: #6c757d;
            margin-right: 0.5rem;
        }
        
        .modal-md {
            max-width: 500px;
        }
        
        .text-warning {
            color: #ffc107 !important;
        }
        
        .text-danger {
            color: #dc3545 !important;
        }
    </style>
</head>
<body>
<main class="main-content">
    <header class="main-header">
        <h1><i class="fas fa-graduation-cap"></i> Gestión de Ofertas Académicas</h1>
        <div class="header-actions">
            <button id="btn-show-form" class="btn-primary">
                <i class="fas fa-plus-circle"></i> Nueva Oferta
            </button>
        </div>
    </header>

    <!-- Área de notificaciones -->
    <div id="notification-area" class="notification-area" style="display: none;">
        <div id="notification" class="notification">
            <i id="notification-icon" class="fas fa-check-circle"></i>
            <span id="notification-message">Mensaje de notificación</span>
            <button type="button" id="notification-close" class="notification-close">
                <i class="fas fa-times"></i>
            </button>
        </div>
    </div>

    <!-- Formulario de Registro (colapsable) -->
    <div id="form-container" class="form-container" style="display: none;">
        <div class="form-card">
            <div class="form-header">
                <h3><i class="fas fa-plus-circle"></i> Registrar Nueva Oferta Académica</h3>
                <button type="button" id="btn-close-form" class="btn-close">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            
            <form th:action="@{/admin/ofertas/registrar}" method="post" id="oferta-form" enctype="multipart/form-data" th:object="${ofertaEditar}">
                <div class="form-content">
                    <!-- Columna Izquierda: Campos principales -->
                    <div class="form-left-column">
                        <!-- Datos Básicos -->
                        <div class="form-section">
                            <h4><i class="fas fa-info-circle"></i> Información Básica</h4>
                            <div class="form-grid">
                                <div class="form-group">
                                    <label for="tipoOferta">Tipo de Oferta *</label>
                                    <select id="tipoOferta" name="tipoOferta" required class="form-control">
                                        <option value="">Seleccione un tipo</option>
                                        <option value="CURSO">Curso</option>
                                        <option value="FORMACION">Formación Profesional</option>
                                        <option value="SEMINARIO">Seminario</option>
                                        <option value="CHARLA">Charla</option>
                                    </select>
                                </div>
                                <div class="form-group">
                                    <label for="nombre">Nombre de la Oferta *</label>
                                    <input type="text" id="nombre" name="nombre" required class="form-control" 
                                           placeholder="Ej: Curso de Programación Java">
                                </div>
                                <div class="form-group">
                                    <label for="modalidad">Modalidad *</label>
                                    <select id="modalidad" name="modalidad" required class="form-control">
                                        <option value="">Seleccione modalidad</option>
                                        <option value="PRESENCIAL">Presencial</option>
                                        <option value="VIRTUAL">Virtual</option>
                                        <option value="HIBRIDA">Híbrida</option>
                                    </select>
                                </div>
                                <div class="form-group">
                                    <label for="cupos">Cantidad de Cupos</label>
                                    <input type="number" id="cupos" name="cupos" class="form-control" min="1" 
                                           placeholder="Número máximo de estudiantes">
                                </div>
                                <div class="form-group">
                                    <label for="fechaInicio">Fecha de Inicio *</label>
                                    <input type="date" id="fechaInicio" name="fechaInicio" class="form-control" required>
                                </div>
                                <div class="form-group">
                                    <label for="fechaFin">Fecha de Fin *</label>
                                    <input type="date" id="fechaFin" name="fechaFin" class="form-control" required>
                                </div>
                            </div>
                            
                            <div class="form-group">
                                <label for="descripcion">Descripción *</label>
                                <textarea id="descripcion" name="descripcion" rows="3" required class="form-control" 
                                          placeholder="Descripción detallada de la oferta académica"></textarea>
                            </div>
                        </div>

                        <!-- Costos -->
                        <div class="form-section">
                            <h4><i class="fas fa-dollar-sign"></i> Información de Costos</h4>
                            <div class="form-grid">
                                <div class="form-group">
                                    <label for="costoInscripcion">Costo de Inscripción</label>
                                    <input type="number" step="0.01" id="costoInscripcion" name="costoInscripcion" 
                                           class="form-control" placeholder="0.00">
                                </div>
                                <div class="form-group" id="grupo-costo-cuota" style="display: none;">
                                    <label for="costoCuota">Costo por Cuota</label>
                                    <input type="number" step="0.01" id="costoCuota" name="costoCuota" 
                                           class="form-control" placeholder="0.00">
                                </div>
                                <div class="form-group" id="grupo-nro-cuotas" style="display: none;">
                                    <label for="nrCuotas">Número de Cuotas</label>
                                    <input type="number" id="nrCuotas" name="nrCuotas" class="form-control" min="1">
                                </div>
                                <div class="form-group" id="grupo-costo-mora" style="display: none;">
                                    <label for="costoMora">Costo por Mora</label>
                                    <input type="number" step="0.01" id="costoMora" name="costoMora" 
                                           class="form-control" placeholder="0.00">
                                </div>
                                <div class="form-group" id="grupo-dia-vencimiento" style="display: none;">
                                    <label for="diaVencimiento">Día de Vencimiento</label>
                                    <input type="number" id="diaVencimiento" name="diaVencimiento" 
                                           class="form-control" min="1" max="29" 
                                           placeholder="Ingrese día del mes (1-29)">
                                    <small class="form-text text-muted">
                                        <i class="fas fa-info-circle"></i>
                                        Día límite para pago sin mora (1-29). Después de esta fecha se aplicará el recargo por mora.
                                    </small>
                                </div>
                            </div>
                        </div>

                        <!-- Certificación -->
                        <div class="form-section">
                            <h4><i class="fas fa-certificate"></i> Certificación</h4>
                            <div class="checkbox-container">
                                <label class="checkbox-label">
                                    <input type="checkbox" id="otorgaCertificado" class="form-checkbox">
                                    <span class="checkmark"></span>
                                    Otorga Certificado
                                </label>
                            </div>
                            
                            <div id="certificado-fields" style="display: none;">
                                <div class="form-group">
                                    <label for="tituloCertificado">Título del Certificado</label>
                                    <input type="text" id="tituloCertificado" name="tituloCertificado" class="form-control" 
                                           placeholder="Ej: Certificado de Finalización en...">
                                </div>
                                <div class="form-group">
                                    <label for="descripcionCertificado">Descripción del Certificado</label>
                                    <textarea id="descripcionCertificado" name="descripcionCertificado" rows="2" 
                                              class="form-control" placeholder="Descripción que aparecerá en el certificado"></textarea>
                                </div>
                            </div>
                        </div>

                        <!-- Categorías -->
                        <div class="form-section">
                            <div class="categoria-header">
                                <h4><i class="fas fa-tags"></i> Categorías</h4>
                                <button type="button" id="btn-gestionar-categorias" class="btn-secondary btn-xs">
                                    <i class="fas fa-cog"></i> Gestionar
                                </button>
                            </div>
                            <div class="form-group">
                                <label for="categoria-select">Seleccionar Categorías</label>
                                <p class="field-description">Seleccione una o más categorías que describan esta oferta académica</p>
                                <div class="categoria-input-group">
                                    <select id="categoria-select" class="form-control categoria-select">
                                        <option value="">-- Seleccione una categoría --</option>
                                        <!-- Las categorías se cargarán dinámicamente desde la base de datos -->
                                    </select>
                                    <button type="button" id="btn-add-categoria" class="btn-add-categoria">
                                        <i class="fas fa-plus"></i> Añadir
                                    </button>
                                </div>
                                
                                <!-- Categorías seleccionadas como chips -->
                                <div class="selected-categories" id="selected-categories" style="display: none;">
                                    <span class="selected-label">Categorías seleccionadas:</span>
                                    <div class="selected-chips" id="selected-chips">
                                        <!-- Las categorías seleccionadas aparecerán aquí como chips -->
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Columna Derecha: Imagen y campos específicos -->
                    <div class="form-right-column">
                        <!-- Imagen de presentación -->
                        <div class="form-section">
                            <h4><i class="fas fa-image"></i> Imagen de Presentación</h4>
                            <div class="image-upload-container">
                                <input type="file" id="imagen" name="imagen" accept="image/*" class="image-input">
                                <label for="imagen" class="image-upload-area">
                                    <div class="upload-placeholder">
                                        <i class="fas fa-cloud-upload-alt"></i>
                                        <p>Subir imagen</p>
                                        <span>JPG, PNG, GIF hasta 5MB</span>
                                    </div>
                                    <img id="image-preview" style="display: none;" alt="Vista previa">
                                </label>
                            </div>
                        </div>

                        <!-- Campos específicos por tipo de oferta -->
                        
                        <!-- Campos para CURSO -->
                        <div id="fields-curso" class="form-section tipo-specific" style="display: none;">
                            <h4><i class="fas fa-book"></i> Información del Curso</h4>
                            <div class="form-group">
                                <label for="planEstudio">Plan de Estudio</label>
                                <textarea id="planEstudio" name="planEstudio" rows="4" class="form-control" 
                                          placeholder="Detalle del plan de estudios del curso"></textarea>
                            </div>
                            <div class="form-group">
                                <label for="temario">Temario</label>
                                <textarea id="temario" name="temario" rows="4" class="form-control" 
                                          placeholder="Temario detallado del curso"></textarea>
                            </div>
                            <div class="form-group">
                                <label for="requisitos">Requisitos Previos</label>
                                <textarea id="requisitos" name="requisitos" rows="2" class="form-control" 
                                          placeholder="Conocimientos o cursos previos necesarios"></textarea>
                            </div>
                            
                            <!-- Docentes a cargo -->
                            <div class="docentes-section">
                                <h5>Docentes a Cargo</h5>
                                <div class="docente-search-container">
                                    <input type="text" id="docente-search" placeholder="Buscar docente..." 
                                           class="form-control">
                                    <div id="docente-results" class="search-results"></div>
                                </div>
                                <div class="docentes-list">
                                    <table id="docentes-table" class="mini-table">
                                        <thead>
                                            <tr>
                                                <th>Docente</th>
                                                <th>Acción</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            <!-- Docentes asignados -->
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>

                        <!-- Campos para FORMACIÓN PROFESIONAL -->
                        <div id="fields-formacion" class="form-section tipo-specific" style="display: none;">
                            <h4><i class="fas fa-graduation-cap"></i> Formación Profesional</h4>
                            <div class="form-group">
                                <label for="planFormacion">Plan de Formación</label>
                                <textarea id="planFormacion" name="planFormacion" rows="4" class="form-control" 
                                          placeholder="Plan detallado de la formación profesional"></textarea>
                            </div>
                            <div class="form-group">
                                <label for="temarioFormacion">Temario</label>
                                <textarea id="temarioFormacion" name="temarioFormacion" rows="4" class="form-control" 
                                          placeholder="Temario de la formación"></textarea>
                            </div>
                            <div class="form-group">
                                <label for="estructuraModular">Estructura Modular</label>
                                <textarea id="estructuraModular" name="estructuraModular" rows="4" class="form-control" 
                                          placeholder="Descripción de los módulos que componen la formación"></textarea>
                            </div>
                            <div class="form-group">
                                <label for="requisitosFormacion">Requisitos</label>
                                <textarea id="requisitosFormacion" name="requisitosFormacion" rows="2" class="form-control" 
                                          placeholder="Requisitos para ingresar a la formación"></textarea>
                            </div>
                            
                            <!-- Docentes para formación también -->
                            <div class="docentes-section">
                                <h5>Docentes a Cargo</h5>
                                <div class="docente-search-container">
                                    <input type="text" id="docente-search-formacion" placeholder="Buscar docente..." 
                                           class="form-control">
                                    <div id="docente-results-formacion" class="search-results"></div>
                                </div>
                                <div class="docentes-list">
                                    <table id="docentes-table-formacion" class="mini-table">
                                        <thead>
                                            <tr>
                                                <th>Docente</th>
                                                <th>Acción</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            <!-- Docentes asignados -->
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>

                        <!-- Campos para CHARLA -->
                        <div id="fields-charla" class="form-section tipo-specific" style="display: none;">
                            <h4><i class="fas fa-microphone"></i> Información de la Charla</h4>
                            <div class="form-group">
                                <label for="disertantesCharla">Disertantes</label>
                                <div class="input-with-button">
                                    <input type="text" id="disertantesCharlaInput" class="form-control" 
                                           placeholder="Nombre del disertante">
                                    <button type="button" class="btn-add-item" onclick="agregarDisertante('charla')">
                                        <i class="fas fa-plus"></i>
                                    </button>
                                </div>
                                <div id="disertantes-charla-list" class="chips-container"></div>
                                <input type="hidden" id="disertantesCharlaHidden" name="disertantesCharla" value="">
                            </div>
                            <div class="form-group">
                                <label for="duracionEstimada">Duración Estimada</label>
                                <input type="text" id="duracionEstimada" name="duracionEstimada" class="form-control" 
                                       placeholder="Ej: 2 horas, 90 minutos">
                            </div>
                            <div class="form-group">
                                <label for="publicoObjetivo">Público Objetivo</label>
                                <input type="text" id="publicoObjetivo" name="publicoObjetivo" class="form-control" 
                                       placeholder="A quién está dirigida la charla">
                            </div>
                            <div class="form-group">
                                <label for="lugarCharla">Lugar o Enlace</label>
                                <input type="text" id="lugarCharla" name="lugarCharla" class="form-control" 
                                       placeholder="Dirección física o enlace de acceso">
                            </div>
                            <div class="form-group">
                                <label for="materialesApoyo">Materiales de Apoyo</label>
                                <textarea id="materialesApoyo" name="materialesApoyo" rows="2" class="form-control" 
                                          placeholder="Descripción de materiales que se proporcionarán"></textarea>
                            </div>
                        </div>

                        <!-- Campos para SEMINARIO -->
                        <div id="fields-seminario" class="form-section tipo-specific" style="display: none;">
                            <h4><i class="fas fa-users"></i> Información del Seminario</h4>
                            <div class="form-group">
                                <label for="disertantesSeminario">Disertantes</label>
                                <div class="input-with-button">
                                    <input type="text" id="disertantesSeminarioInput" class="form-control" 
                                           placeholder="Nombre del disertante">
                                    <button type="button" class="btn-add-item" onclick="agregarDisertante('seminario')">
                                        <i class="fas fa-plus"></i>
                                    </button>
                                </div>
                                <div id="disertantes-seminario-list" class="chips-container"></div>
                                <input type="hidden" id="disertantesSeminarioHidden" name="disertantesSeminario" value="">
                            </div>
                            <div class="form-group">
                                <label for="fechaSeminario">Fecha del Seminario</label>
                                <input type="date" id="fechaSeminario" name="fechaSeminario" class="form-control">
                            </div>
                            <div class="form-group">
                                <label for="horaSeminario">Hora del Seminario</label>
                                <input type="time" id="horaSeminario" name="horaSeminario" class="form-control">
                            </div>
                            <div class="form-group">
                                <label for="duracionSeminario">Duración Estimada</label>
                                <input type="text" id="duracionSeminario" name="duracionSeminario" class="form-control" 
                                       placeholder="Ej: 4 horas, medio día">
                            </div>
                            <div class="form-group">
                                <label for="requisitosParticipacion">Requisitos de Participación</label>
                                <textarea id="requisitosParticipacion" name="requisitosParticipacion" rows="2" 
                                          class="form-control" placeholder="Requisitos para participar (opcional)"></textarea>
                            </div>
                            <div class="form-group">
                                <label for="lugarSeminario">Lugar o Enlace</label>
                                <input type="text" id="lugarSeminario" name="lugarSeminario" class="form-control" 
                                       placeholder="Dirección física o enlace de acceso">
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Sección de Horarios (para cursos y formaciones) -->
                <div id="seccion-horarios" class="form-section" style="display: none;">
                    <h4><i class="fas fa-clock"></i> Horarios</h4>
                    <div class="horarios-container">
                        <div class="horario-form">
                            <div class="form-row">
                                <div class="form-group">
                                    <label for="dia-horario">Día de la semana</label>
                                    <select id="dia-horario" class="form-control">
                                        <option value="">Seleccionar día</option>
                                        <option value="LUNES">Lunes</option>
                                        <option value="MARTES">Martes</option>
                                        <option value="MIERCOLES">Miércoles</option>
                                        <option value="JUEVES">Jueves</option>
                                        <option value="VIERNES">Viernes</option>
                                        <option value="SABADO">Sábado</option>
                                        <option value="DOMINGO">Domingo</option>
                                    </select>
                                </div>
                                <div class="form-group">
                                    <label for="hora-inicio">Hora de inicio</label>
                                    <input type="time" id="hora-inicio" class="form-control">
                                </div>
                                <div class="form-group">
                                    <label for="hora-fin">Hora de fin</label>
                                    <input type="time" id="hora-fin" class="form-control">
                                </div>
                                <div class="form-group">
                                    <button type="button" class="btn-add-horario" onclick="agregarHorario()">
                                        <i class="fas fa-plus"></i> Agregar
                                    </button>
                                </div>
                            </div>
                        </div>
                        
                        <div class="horarios-list">
                            <h5>Horarios programados:</h5>
                            <div id="lista-horarios" class="horarios-chips">
                                <p class="no-horarios">No hay horarios programados</p>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Campos ocultos para datos del formulario -->
                <input type="hidden" id="categorias" name="categorias" value="">
                <input type="hidden" id="docentesCurso" name="docentesCurso" value="">
                <input type="hidden" id="docentesFormacion" name="docentesFormacion" value="">
                <input type="hidden" id="horarios" name="horarios" value="">
                <input type="hidden" id="otorgaCertificadoHidden" name="otorgaCertificado" value="false">
                <input type="hidden" id="idOfertaModificar" name="idOferta" value="">
                
                <div class="form-actions">
                    <button type="submit" id="btn-submit-form" class="btn-submit">
                        <i class="fas fa-save"></i> <span id="btn-submit-text">Registrar Oferta</span>
                    </button>
                    <button type="button" id="btn-cancel-form" class="btn-cancel">
                        <i class="fas fa-times"></i> Cancelar
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- Sección de Filtros y Tabla -->
    <div class="ofertas-table-section">
        <div class="filters-section">
            <div class="filters-header">
                <h3><i class="fas fa-filter"></i> Filtros y Búsqueda</h3>
            </div>
            <div class="filters-content">
                <div class="search-container">
                    <div class="search-input-container">
                        <input type="text" id="search-input" placeholder="Buscar por nombre de oferta..." class="search-input">
                        <i class="fas fa-search search-icon"></i>
                    </div>
                </div>
                <div class="filters-grid">
                    <select id="filtro-tipo" class="filter-select">
                        <option value="">Todos los tipos</option>
                        <option value="CURSO">Curso</option>
                        <option value="FORMACION">Formación</option>
                        <option value="SEMINARIO">Seminario</option>
                        <option value="CHARLA">Charla</option>
                    </select>
                    <select id="filtro-modalidad" class="filter-select">
                        <option value="">Todas las modalidades</option>
                        <option value="PRESENCIAL">Presencial</option>
                        <option value="VIRTUAL">Virtual</option>
                        <option value="HIBRIDA">Híbrida</option>
                    </select>
                    <select id="filtro-estado" class="filter-select">
                        <option value="">Todos los estados</option>
                        <option value="ACTIVA">Activa</option>
                        <option value="INACTIVA">Inactiva</option>
                        <option value="FINALIZADA">Finalizada</option>
                    </select>
                    <select id="filtro-certificado" class="filter-select">
                        <option value="">Certificado</option>
                        <option value="SI">Con certificado</option>
                        <option value="NO">Sin certificado</option>
                    </select>
                    <input type="number" id="filtro-costo-min" placeholder="Costo mínimo" class="filter-input">
                    <input type="number" id="filtro-costo-max" placeholder="Costo máximo" class="filter-input">
                </div>
                <div class="filters-actions">
                    <button id="btn-apply-filters" class="btn-secondary">
                        <i class="fas fa-search"></i> Aplicar Filtros
                    </button>
                    <button id="btn-clear-filters" class="btn-outline">
                        <i class="fas fa-times"></i> Limpiar
                    </button>
                </div>
            </div>
        </div>

        <div class="table-section">
            <div class="table-header">
                <h3><i class="fas fa-list"></i> Lista de Ofertas Académicas</h3>
                <div class="table-stats">
                    <span class="stats-text">Total: <strong id="total-ofertas" th:text="${#lists.size(ofertas ?: {})}">0</strong> ofertas</span>
                </div>
            </div>
            
            <div class="table-container">
                <table id="ofertas-table" class="ofertas-table">
                    <thead>
                        <tr>
                            <th>Nombre</th>
                            <th>Tipo</th>
                            <th>Modalidad</th>
                            <th>Cupos</th>
                            <th>Fecha Inicio</th>
                            <th>Fecha Fin</th>
                            <th>Estado</th>
                            <th>Acciones</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr th:each="oferta : ${ofertas}" th:if="${ofertas != null and !ofertas.isEmpty()}">
                            <td th:text="${oferta.nombre}">Nombre de la oferta</td>
                            <td th:text="${oferta.tipoOferta}">CURSO</td>
                            <td th:text="${oferta.modalidad}">PRESENCIAL</td>
                            <td class="cupos-cell">
                                <span th:if="${oferta.cupos != null}" 
                                      th:class="${oferta.tieneCuposDisponibles() ? 'cupos-disponibles' : 'cupos-agotados'}"
                                      th:text="${oferta.cupos}">30</span>
                                <span th:if="${oferta.cupos == null}" class="cupos-ilimitados">∞</span>
                            </td>
                            <td th:text="${#temporals.format(oferta.fechaInicio, 'dd/MM/yyyy')}">01/01/2024</td>
                            <td th:text="${#temporals.format(oferta.fechaFin, 'dd/MM/yyyy')}">31/12/2024</td>
                            <td>
                                <span class="estado-badge" th:text="${oferta.estado}">ACTIVA</span>
                            </td>
                            <td class="acciones-cell">
                                <button class="btn-accion btn-ver" 
                                        title="Ver información"
                                        th:data-id="${oferta.idOferta}"
                                        onclick="verDetalleOferta(this.getAttribute('data-id'))">
                                    <i class="fas fa-eye"></i>
                                </button>
                                <button class="btn-accion btn-modificar" 
                                        title="Modificar"
                                        th:data-id="${oferta.idOferta}"
                                        th:data-nombre="${oferta.nombre}"
                                        onclick="modificarOferta(this.getAttribute('data-id'), this.getAttribute('data-nombre'))">
                                    <i class="fas fa-edit"></i>
                                </button>
                            </td>
                        </tr>
                        
                        <!-- Mensaje cuando no hay ofertas -->
                        <tr th:if="${ofertas == null or ofertas.isEmpty()}">
                            <td colspan="8" class="text-center text-muted py-4">
                                <i class="fas fa-inbox fa-2x mb-2"></i><br>
                                No hay ofertas académicas registradas
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>
            
            <div class="table-pagination">
                <div class="pagination-info">
                    Mostrando 1-1 de 1 ofertas
                </div>
                <div class="pagination-controls">
                    <button class="btn-pagination" disabled>
                        <i class="fas fa-chevron-left"></i> Anterior
                    </button>
                    <span class="pagination-pages">
                        <button class="btn-page active">1</button>
                    </span>
                    <button class="btn-pagination" disabled>
                        Siguiente <i class="fas fa-chevron-right"></i>
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal de Gestión de Categorías -->
    <div id="categoriaModal" class="modal-overlay" style="display: none;">
        <div class="modal-content modal-lg">
            <div class="modal-header">
                <h3 id="categoriaModalLabel">Gestión de Categorías</h3>
                <button type="button" class="btn-close" aria-label="Cerrar" onclick="categoriaModal.hide()">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            
            <div class="modal-body">
                <!-- Alertas -->
                <div id="categoriaAlert"></div>
                
                <!-- Sección para agregar nueva categoría -->
                <div class="categoria-form-section">
                    <h4><i class="fas fa-plus"></i> Nueva Categoría</h4>
                    <form id="categoriaForm">
                        <input type="hidden" id="categoriaId" name="categoriaId">
                        
                        <div class="form-group">
                            <label for="categoriaNombre">
                                <i class="fas fa-tag"></i> Nombre de la Categoría *
                            </label>
                            <input type="text" 
                                   id="categoriaNombre" 
                                   name="categoriaNombre" 
                                   class="form-control" 
                                   placeholder="Ej: Tecnología, Idiomas, Arte..."
                                   maxlength="100"
                                   required>
                            <small class="form-text text-muted">Entre 2 y 100 caracteres</small>
                        </div>
                        
                        <div class="form-group">
                            <label for="categoriaDescripcion">
                                <i class="fas fa-align-left"></i> Descripción *
                            </label>
                            <textarea id="categoriaDescripcion" 
                                      name="categoriaDescripcion" 
                                      class="form-control" 
                                      rows="3"
                                      placeholder="Descripción detallada de la categoría..."
                                      maxlength="500"
                                      required></textarea>
                            <small class="form-text text-muted">Entre 5 y 500 caracteres</small>
                        </div>
                        
                        <div class="form-actions">
                            <button type="button" class="btn btn-primary" onclick="categoriaController.guardarCategoria()">
                                <i class="fas fa-save"></i> <span id="btnGuardarText">Crear Categoría</span>
                            </button>
                            <button type="button" class="btn btn-secondary" onclick="categoriaController.cancelarEdicion()">
                                <i class="fas fa-times"></i> Cancelar
                            </button>
                        </div>
                    </form>
                </div>
                
                <!-- Separador -->
                <hr class="modal-separator">
                
                <!-- Sección de categorías existentes -->
                <div class="categorias-table-section">
                    <div class="table-header">
                        <h4><i class="fas fa-list"></i> Categorías Existentes</h4>
                        <div class="table-stats">
                            <span id="contadorCategorias">Total: 0 categorías</span>
                        </div>
                    </div>
                    
                    <!-- Loading y error messages -->
                    <div id="categoriasLoading" class="text-center">
                        <i class="fas fa-spinner fa-spin"></i> Cargando categorías...
                    </div>
                    <div id="categoriasError" class="alert alert-danger" style="display: none;"></div>
                    
                    <!-- Tabla de categorías -->
                    <div class="table-responsive">
                        <table id="categoriasTable" class="table table-striped" style="display: none;">
                            <thead class="table-dark">
                                <tr>
                                    <th>Nombre</th>
                                    <th>Descripción</th>
                                    <th width="100" class="text-center">Acciones</th> <!-- Ancho fijo y centrado -->
                                </tr>
                            </thead>
                            <tbody id="categoriasTableBody">
                                <!-- Las categorías se cargan dinámicamente -->
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal Ver Oferta Completa -->
    <div id="modal-ver-oferta" class="modal-overlay" style="display: none;">
        <div class="modal-content modal-large">
            <div class="modal-header">
                <h3><i class="fas fa-eye"></i> Detalles de la Oferta Académica</h3>
                <button type="button" class="btn-close" onclick="cerrarModalVerOferta()">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            
            <div class="modal-body">
                <div class="oferta-details-container">
                    <!-- Información Principal -->
                    <div class="detail-section">
                        <h4><i class="fas fa-info-circle"></i> Información General</h4>
                        <div class="detail-grid">
                            <div class="detail-item">
                                <label>Nombre:</label>
                                <span id="modal-nombre">-</span>
                            </div>
                            <div class="detail-item">
                                <label>Tipo:</label>
                                <span id="modal-tipo">-</span>
                            </div>
                            <div class="detail-item">
                                <label>Modalidad:</label>
                                <span id="modal-modalidad">-</span>
                            </div>
                            <div class="detail-item">
                                <label>Estado:</label>
                                <span id="modal-estado" class="estado-badge">-</span>
                            </div>
                        </div>
                        
                        <div class="detail-item full-width">
                            <label>Descripción:</label>
                            <p id="modal-descripcion">-</p>
                        </div>
                    </div>

                    <!-- Fechas y Duración -->
                    <div class="detail-section">
                        <h4><i class="fas fa-calendar"></i> Fechas y Duración</h4>
                        <div class="detail-grid">
                            <div class="detail-item">
                                <label>Fecha de Inicio:</label>
                                <span id="modal-fecha-inicio">-</span>
                            </div>
                            <div class="detail-item">
                                <label>Fecha de Fin:</label>
                                <span id="modal-fecha-fin">-</span>
                            </div>
                            <div class="detail-item">
                                <label>Duración:</label>
                                <span id="modal-duracion">-</span>
                            </div>
                            <div class="detail-item">
                                <label>Certificado:</label>
                                <span id="modal-certificado">-</span>
                            </div>
                        </div>
                    </div>

                    <!-- Cupos y Costos -->
                    <div class="detail-section">
                        <h4><i class="fas fa-users"></i> Cupos y Costos</h4>
                        <div class="detail-grid">
                            <div class="detail-item">
                                <label>Cupos Totales:</label>
                                <span id="modal-cupos">-</span>
                            </div>
                            <div class="detail-item">
                                <label>Inscriptos:</label>
                                <span id="modal-inscriptos">-</span>
                            </div>
                            <div class="detail-item">
                                <label>Costo de Inscripción:</label>
                                <span id="modal-costo">-</span>
                            </div>
                            <div class="detail-item">
                                <label>Disponibles:</label>
                                <span id="modal-disponibles">-</span>
                            </div>
                        </div>
                    </div>

                    <!-- Horarios -->
                    <div class="detail-section">
                        <h4><i class="fas fa-clock"></i> Horarios</h4>
                        <div id="modal-horarios" class="horarios-list">
                            <p class="no-data">No hay horarios definidos</p>
                        </div>
                    </div>

                    <!-- Categorías -->
                    <div class="detail-section">
                        <h4><i class="fas fa-tags"></i> Categorías</h4>
                        <div id="modal-categorias" class="categorias-list">
                            <p class="no-data">No hay categorías asignadas</p>
                        </div>
                    </div>

                    <!-- Docentes/Disertantes -->
                    <div class="detail-section">
                        <h4><i class="fas fa-chalkboard-teacher"></i> Docentes/Disertantes</h4>
                        <div id="modal-docentes" class="docentes-list">
                            <p class="no-data">No hay docentes asignados</p>
                        </div>
                    </div>
                </div>
            </div>

            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" onclick="cerrarModalVerOferta()">
                    <i class="fas fa-times"></i> Cerrar
                </button>
                <button type="button" class="btn btn-danger" onclick="eliminarOfertaDesdeModal()">
                    <i class="fas fa-trash"></i> Eliminar Oferta
                </button>
            </div>
        </div>
    </div>

    <!-- Modal de Confirmación para Eliminar -->
    <div id="confirmDeleteModal" class="modal-overlay" style="display: none;">
        <div class="modal-content modal-sm">
            <div class="modal-header">
                <h3><i class="fas fa-exclamation-triangle text-danger"></i> Confirmar Eliminación</h3>
                <button type="button" class="btn-close" aria-label="Cerrar" onclick="cerrarModalConfirmacion()">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            
            <div class="modal-body">
                <p>¿Estás seguro de que deseas eliminar la oferta académica <strong id="nombre-oferta-eliminar">-</strong>?</p>
                <p class="text-muted">Esta acción no se puede deshacer.</p>
            </div>

            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" onclick="cerrarModalConfirmacion()">
                    <i class="fas fa-times"></i> Cancelar
                </button>
                <button id="btn-confirmar-eliminar" type="button" class="btn btn-danger" onclick="ejecutarEliminacion()">
                    <i class="fas fa-trash"></i> Eliminar
                </button>
            </div>
        </div>
    </div>

    <!-- Modal de Detalle Completo de Oferta -->
    <div id="modalDetalleOferta" class="modal-overlay" style="display: none;">
        <div class="modal-content modal-xl">
            <div class="modal-header">
                <h3><i class="fas fa-graduation-cap"></i> Detalle de Oferta Académica</h3>
                <button type="button" class="btn-close" onclick="cerrarModalDetalle()">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            
            <div class="modal-body">
                <!-- Información General -->
                <div class="oferta-detalle-section">
                    <div class="section-header">
                        <h4><i class="fas fa-info-circle"></i> Información General</h4>
                    </div>
                    <div class="oferta-info-grid">
                        <div class="info-item">
                            <label>Nombre:</label>
                            <span id="detalle-nombre">-</span>
                        </div>
                        <div class="info-item">
                            <label>Tipo:</label>
                            <span id="detalle-tipo" class="badge">-</span>
                        </div>
                        <div class="info-item">
                            <label>Modalidad:</label>
                            <span id="detalle-modalidad" class="badge">-</span>
                        </div>
                        <div class="info-item">
                            <label>Estado:</label>
                            <span id="detalle-estado" class="badge">-</span>
                        </div>
                        <div class="info-item">
                            <label>Categorías:</label>
                            <div id="detalle-categorias" class="categorias-list">-</div>
                        </div>
                        <div class="info-item">
                            <label>Costo:</label>
                            <span id="detalle-costo" class="precio">-</span>
                        </div>
                    </div>
                </div>

                <!-- Imagen y Descripción -->
                <div class="oferta-detalle-section">
                    <div class="section-header">
                        <h4><i class="fas fa-image"></i> Imagen y Descripción</h4>
                    </div>
                    <div class="imagen-descripcion-container">
                        <div class="imagen-container">
                            <img id="detalle-imagen" src="" alt="Imagen de la oferta" style="display: none;">
                            <div id="detalle-sin-imagen" class="sin-imagen-placeholder">
                                <i class="fas fa-image"></i>
                                <span>Sin imagen</span>
                            </div>
                        </div>
                        <div class="descripcion-container">
                            <label>Descripción:</label>
                            <div id="detalle-descripcion" class="descripcion-content">-</div>
                        </div>
                    </div>
                </div>

                <!-- Fechas -->
                <div class="oferta-detalle-section">
                    <div class="section-header">
                        <h4><i class="fas fa-calendar"></i> Fechas Importantes</h4>
                    </div>
                    <div class="oferta-info-grid">
                        <div class="info-item">
                            <label>Fecha de Inicio:</label>
                            <span id="detalle-fecha-inicio">-</span>
                        </div>
                        <div class="info-item">
                            <label>Fecha de Fin:</label>
                            <span id="detalle-fecha-fin">-</span>
                        </div>
                        <div class="info-item">
                            <label>Fecha de Inscripción:</label>
                            <span id="detalle-fecha-inscripcion">-</span>
                        </div>
                        <div class="info-item">
                            <label>Fecha Límite de Inscripción:</label>
                            <span id="detalle-fecha-limite">-</span>
                        </div>
                    </div>
                </div>

                <!-- Capacidad -->
                <div class="oferta-detalle-section">
                    <div class="section-header">
                        <h4><i class="fas fa-users"></i> Capacidad</h4>
                    </div>
                    <div class="oferta-info-grid">
                        <div class="info-item">
                            <label>Capacidad Mínima:</label>
                            <span id="detalle-capacidad-min">-</span>
                        </div>
                        <div class="info-item">
                            <label>Capacidad Máxima:</label>
                            <span id="detalle-capacidad-max">-</span>
                        </div>
                    </div>
                </div>

                <!-- Certificación -->
                <div id="seccion-certificacion" class="oferta-detalle-section" style="display: none;">
                    <div class="section-header">
                        <h4><i class="fas fa-certificate"></i> Certificación</h4>
                    </div>
                    <div class="oferta-info-grid">
                        <div class="info-item">
                            <label>Otorga Certificado:</label>
                            <span id="detalle-otorga-certificado">-</span>
                        </div>
                        <div class="info-item">
                            <label>Costo de Certificado:</label>
                            <span id="detalle-costo-certificado" class="precio">-</span>
                        </div>
                        <div class="info-item full-width">
                            <label>Descripción del Certificado:</label>
                            <div id="detalle-descripcion-certificado">-</div>
                        </div>
                    </div>
                </div>

                <!-- Datos Específicos por Tipo -->
                <!-- Datos para CURSO -->
                <div id="datos-curso" class="oferta-detalle-section tipo-especifico" style="display: none;">
                    <div class="section-header">
                        <h4><i class="fas fa-book"></i> Información del Curso</h4>
                    </div>
                    <div class="oferta-info-grid">
                        <div class="info-item">
                            <label>Costo por Cuota:</label>
                            <span id="detalle-curso-costo-cuota" class="precio">-</span>
                        </div>
                        <div class="info-item">
                            <label>Número de Cuotas:</label>
                            <span id="detalle-curso-nro-cuotas">-</span>
                        </div>
                        <div class="info-item">
                            <label>Costo de Mora:</label>
                            <span id="detalle-curso-costo-mora" class="precio">-</span>
                        </div>
                        <div class="info-item">
                            <label>Día de Vencimiento:</label>
                            <span id="detalle-curso-dia-vencimiento">-</span>
                        </div>
                        <div class="info-item full-width">
                            <label>Docentes:</label>
                            <div id="detalle-curso-docentes" class="docentes-list">-</div>
                        </div>
                        <div class="info-item full-width">
                            <label>Horarios:</label>
                            <div id="detalle-curso-horarios" class="horarios-list">-</div>
                        </div>
                    </div>
                </div>

                <!-- Datos para FORMACIÓN -->
                <div id="datos-formacion" class="oferta-detalle-section tipo-especifico" style="display: none;">
                    <div class="section-header">
                        <h4><i class="fas fa-graduation-cap"></i> Información de la Formación</h4>
                    </div>
                    <div class="oferta-info-grid">
                        <div class="info-item">
                            <label>Costo por Cuota:</label>
                            <span id="detalle-formacion-costo-cuota" class="precio">-</span>
                        </div>
                        <div class="info-item">
                            <label>Número de Cuotas:</label>
                            <span id="detalle-formacion-nro-cuotas">-</span>
                        </div>
                        <div class="info-item">
                            <label>Costo de Mora:</label>
                            <span id="detalle-formacion-costo-mora" class="precio">-</span>
                        </div>
                        <div class="info-item">
                            <label>Día de Vencimiento:</label>
                            <span id="detalle-formacion-dia-vencimiento">-</span>
                        </div>
                        <div class="info-item full-width">
                            <label>Docentes:</label>
                            <div id="detalle-formacion-docentes" class="docentes-list">-</div>
                        </div>
                        <div class="info-item full-width">
                            <label>Horarios:</label>
                            <div id="detalle-formacion-horarios" class="horarios-list">-</div>
                        </div>
                    </div>
                </div>

                <!-- Datos para CHARLA -->
                <div id="datos-charla" class="oferta-detalle-section tipo-especifico" style="display: none;">
                    <div class="section-header">
                        <h4><i class="fas fa-microphone"></i> Información de la Charla</h4>
                    </div>
                    <div class="oferta-info-grid">
                        <div class="info-item full-width">
                            <label>Disertantes:</label>
                            <div id="detalle-charla-disertantes" class="disertantes-list">-</div>
                        </div>
                    </div>
                </div>

                <!-- Datos para SEMINARIO -->
                <div id="datos-seminario" class="oferta-detalle-section tipo-especifico" style="display: none;">
                    <div class="section-header">
                        <h4><i class="fas fa-chalkboard-teacher"></i> Información del Seminario</h4>
                    </div>
                    <div class="oferta-info-grid">
                        <div class="info-item full-width">
                            <label>Disertantes:</label>
                            <div id="detalle-seminario-disertantes" class="disertantes-list">-</div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="modal-footer">
                <div class="action-buttons">
                    <button type="button" class="btn-primary" onclick="cerrarModalDetalle()">
                        <i class="fas fa-times"></i>
                        Cerrar
                    </button>
                    <button type="button" id="btn-cambiar-estado" class="btn-secondary" onclick="cambiarEstadoOferta()">
                        <i id="icon-estado" class="fas fa-toggle-on"></i>
                        <span id="text-estado">Dar de Baja</span>
                    </button>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Modal de Error para Cambio de Estado -->
    <div id="modalErrorEstado" class="modal-overlay" style="display: none;">
        <div class="modal-content modal-md">
            <div class="modal-header">
                <h3><i class="fas fa-exclamation-triangle text-warning"></i> No se puede cambiar el estado</h3>
                <button type="button" class="btn-close" onclick="cerrarModalError()">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            
            <div class="modal-body">
                <div class="error-content">
                    <div class="error-icon">
                        <i id="error-icon" class="fas fa-exclamation-circle"></i>
                    </div>
                    <div class="error-message">
                        <h4 id="error-title">Error al cambiar estado</h4>
                        <p id="error-description">Descripción del error</p>
                        <div id="error-suggestions" class="error-suggestions" style="display: none;">
                            <h5><i class="fas fa-lightbulb"></i> Sugerencias:</h5>
                            <ul id="error-suggestions-list">
                            </ul>
                        </div>
                    </div>
                </div>
            </div>

            <div class="modal-footer">
                <button type="button" class="btn btn-primary" onclick="cerrarModalError()">
                    <i class="fas fa-check"></i> Entendido
                </button>
            </div>
        </div>
    </div>
    
    <!-- SCRIPT COMPLETO INLINE - SIN ARCHIVOS EXTERNOS -->
    <script>
        console.log('🔥 SCRIPT INLINE CARGADO');
        
        document.addEventListener('DOMContentLoaded', function() {
            console.log('✅ DOM CARGADO');
            
            // Test: Verificar que los botones de ver detalle estén presentes
            setTimeout(function() {
                const botonesVer = document.querySelectorAll('.btn-ver');
                console.log('🔍 Botones de ver encontrados:', botonesVer.length);
                botonesVer.forEach((btn, index) => {
                    console.log(`- Botón ${index + 1}:`, btn.getAttribute('data-id'));
                });
            }, 1000);
            
            // Referencias a elementos
            const btnShowForm = document.getElementById('btn-show-form');
            const formContainer = document.getElementById('form-container');
            const btnCloseForm = document.getElementById('btn-close-form');
            const btnGestionarCategorias = document.getElementById('btn-gestionar-categorias');
            
            console.log('Elementos encontrados:', {
                btnShowForm: !!btnShowForm,
                formContainer: !!formContainer,
                btnCloseForm: !!btnCloseForm,
                btnGestionarCategorias: !!btnGestionarCategorias
            });
            
            // Manejador del botón mostrar formulario
            if (btnShowForm && formContainer) {
                btnShowForm.addEventListener('click', function(e) {
                    e.preventDefault();
                    console.log('👆 CLICK EN NUEVA OFERTA');
                    
                    // Mostrar formulario con animación
                    formContainer.style.display = 'block';
                    
                    setTimeout(() => {
                        formContainer.classList.add('show');
                        console.log('📝 FORMULARIO MOSTRADO');
                    }, 10);
                });
            }
            
            // Manejador del botón cerrar formulario
            if (btnCloseForm && formContainer) {
                btnCloseForm.addEventListener('click', function(e) {
                    e.preventDefault();
                    console.log('❌ CERRANDO FORMULARIO');
                    
                    formContainer.classList.remove('show');
                    setTimeout(() => {
                        formContainer.style.display = 'none';
                    }, 500);
                });
            }
            
            // Manejador del botón gestionar categorías
            if (btnGestionarCategorias) {
                btnGestionarCategorias.addEventListener('click', function(e) {
                    e.preventDefault();
                    console.log('📋 ABRIENDO GESTIÓN DE CATEGORÍAS');
                    
                    const modal = document.getElementById('categoriaModal');
                    if (modal) {
                        modal.style.display = 'flex';
                        cargarCategorias();
                    }
                });
            }
            
            // Manejador del botón añadir categoría
            const btnAddCategoria = document.getElementById('btn-add-categoria');
            if (btnAddCategoria) {
                btnAddCategoria.addEventListener('click', function(e) {
                    e.preventDefault();
                    añadirCategoriaSeleccionada();
                });
            }
            
            // Manejador para mostrar campos específicos según tipo de oferta
            const tipoOfertaSelect = document.getElementById('tipoOferta');
            if (tipoOfertaSelect) {
                tipoOfertaSelect.addEventListener('change', function() {
                    mostrarCamposEspecificos(this.value);
                });
            }
            
            // Event listeners para disertantes (Enter key)
            const disertantesCharlaInput = document.getElementById('disertantesCharlaInput');
            if (disertantesCharlaInput) {
                disertantesCharlaInput.addEventListener('keypress', function(e) {
                    if (e.key === 'Enter') {
                        e.preventDefault();
                        agregarDisertante('charla');
                    }
                });
            }
            
            const disertantesSeminarioInput = document.getElementById('disertantesSeminarioInput');
            if (disertantesSeminarioInput) {
                disertantesSeminarioInput.addEventListener('keypress', function(e) {
                    if (e.key === 'Enter') {
                        e.preventDefault();
                        agregarDisertante('seminario');
                    }
                });
            }
            
            // Cargar categorías al iniciar
            cargarCategoriasSelect();
            
            // Event listener para envío del formulario
            const formulario = document.getElementById('oferta-form');
            if (formulario) {
                formulario.addEventListener('submit', function(e) {
                    e.preventDefault(); // Prevenir envío tradicional
                    console.log('📤 Formulario enviado');
                    
                    const tipoOferta = document.getElementById('tipoOferta').value;
                    
                    // Actualizar todos los campos hidden antes de enviar
                    actualizarHorariosHidden();
                    actualizarDocentesHidden('curso');
                    actualizarDocentesHidden('formacion');
                    actualizarDisertantesHidden('charla');
                    actualizarDisertantesHidden('seminario');
                    actualizarCategoriaHidden();
                    actualizarCertificadoHidden();
                    
                    // Validar según tipo de oferta
                    if (!validarFormulario(tipoOferta)) {
                        return false;
                    }
                    
                    // Enviar con AJAX
                    enviarFormularioAjax();
                });
            }
            
            // Event listener para cerrar notificación
            const notificationClose = document.getElementById('notification-close');
            if (notificationClose) {
                notificationClose.addEventListener('click', ocultarNotificacion);
            }
            
            console.log('🎉 GESTIÓN DE OFERTAS INICIALIZADA');
        });
        
        // Función para mostrar campos específicos según tipo de oferta
        function mostrarCamposEspecificos(tipoOferta) {
            console.log('🔄 Cambiando tipo de oferta a:', tipoOferta);
            
            // Limpiar datos anteriores
            limpiarDatosFormulario();
            
            // Ocultar todas las secciones específicas
            const seccionesEspecificas = document.querySelectorAll('.tipo-specific');
            seccionesEspecificas.forEach(seccion => {
                seccion.style.display = 'none';
            });
            
            // Ocultar sección de horarios por defecto
            const seccionHorarios = document.getElementById('seccion-horarios');
            seccionHorarios.style.display = 'none';
            
            // Controlar campos de cuotas en la sección principal de costos
            const grupoCostoCuota = document.getElementById('grupo-costo-cuota');
            const grupoNroCuotas = document.getElementById('grupo-nro-cuotas');
            const grupoCostoMora = document.getElementById('grupo-costo-mora');
            const grupoDiaVencimiento = document.getElementById('grupo-dia-vencimiento');
            
            // Mostrar campos de cuotas solo para CURSO y FORMACION
            const mostrarCamposCuotas = tipoOferta === 'CURSO' || tipoOferta === 'FORMACION';
            
            if (grupoCostoCuota) grupoCostoCuota.style.display = mostrarCamposCuotas ? 'block' : 'none';
            if (grupoNroCuotas) grupoNroCuotas.style.display = mostrarCamposCuotas ? 'block' : 'none';
            if (grupoCostoMora) grupoCostoMora.style.display = mostrarCamposCuotas ? 'block' : 'none';
            if (grupoDiaVencimiento) grupoDiaVencimiento.style.display = mostrarCamposCuotas ? 'block' : 'none';
            
            // Mostrar la sección correspondiente al tipo seleccionado
            let seccionMostrar = null;
            switch(tipoOferta) {
                case 'CURSO':
                    seccionMostrar = document.getElementById('fields-curso');
                    // Mostrar horarios para curso
                    seccionHorarios.style.display = 'block';
                    // Inicializar búsqueda de docentes para curso
                    console.log('🔍 Inicializando búsqueda para CURSO');
                    inicializarBusquedaDocentes('docente-search', 'docente-results', 'docentes-table');
                    break;
                    
                case 'FORMACION':
                    seccionMostrar = document.getElementById('fields-formacion');
                    // Mostrar horarios para formación
                    seccionHorarios.style.display = 'block';
                    // Inicializar búsqueda de docentes para formación
                    console.log('🔍 Inicializando búsqueda para FORMACION');
                    inicializarBusquedaDocentes('docente-search-formacion', 'docente-results-formacion', 'docentes-table-formacion');
                    break;
                    
                case 'CHARLA':
                    seccionMostrar = document.getElementById('fields-charla');
                    break;
                    
                case 'SEMINARIO':
                    seccionMostrar = document.getElementById('fields-seminario');
                    break;
                    
                default:
                    console.log('⚠️ Tipo de oferta no reconocido:', tipoOferta);
                    return;
            }
            
            if (seccionMostrar) {
                seccionMostrar.style.display = 'block';
                console.log('✅ Mostrando campos específicos para:', tipoOferta);
            }
        }
        
        // Función para limpiar datos del formulario cuando se cambia tipo
        function limpiarDatosFormulario() {
            // Limpiar docentes seleccionados
            docentesSeleccionados.curso = [];
            docentesSeleccionados.formacion = [];
            
            // Limpiar horarios
            horariosSeleccionados = [];
            
            // Limpiar disertantes
            disertantesCharla = [];
            disertantesSeminario = [];
            
            // Limpiar tablas de docentes
            const tablaCurso = document.getElementById('docentes-table');
            const tablaFormacion = document.getElementById('docentes-table-formacion');
            
            if (tablaCurso) {
                const tbody = tablaCurso.querySelector('tbody');
                if (tbody) tbody.innerHTML = '';
            }
            
            if (tablaFormacion) {
                const tbody = tablaFormacion.querySelector('tbody');
                if (tbody) tbody.innerHTML = '';
            }
            
            // Limpiar visualizaciones
            actualizarHorariosChips();
            actualizarDisertantesChips('charla');
            actualizarDisertantesChips('seminario');
            
            // Actualizar campos hidden
            actualizarDocentesHidden('curso');
            actualizarDocentesHidden('formacion');
            
            console.log('🧹 Datos del formulario limpiados');
        }
        
        // Variables globales para docentes seleccionados
        let docentesSeleccionados = {
            curso: [],
            formacion: []
        };
        
        // Variable para rastrear event listeners ya agregados
        let docenteSearchListenersAdded = {
            'docente-search': false,
            'docente-search-formacion': false
        };
        
        // Función para inicializar búsqueda de docentes
        function inicializarBusquedaDocentes(inputId, resultsId, tableId) {
            console.log('🔧 Inicializando búsqueda de docentes para:', inputId);
            
            const searchInput = document.getElementById(inputId);
            const resultsDiv = document.getElementById(resultsId);
            
            if (!searchInput || !resultsDiv) {
                console.warn('⚠️ No se encontraron elementos:', inputId, resultsId);
                return;
            }
            
            console.log('✅ Elementos encontrados:', searchInput, resultsDiv);
            
            // Evitar agregar múltiples event listeners
            if (docenteSearchListenersAdded[inputId]) {
                console.log('⏭️ Event listener ya agregado para:', inputId);
                return;
            }
            
            let timeoutId;
            
            searchInput.addEventListener('input', function() {
                console.log('📝 Input detectado:', this.value);
                clearTimeout(timeoutId);
                const query = this.value.trim();
                
                if (query.length < 2) {
                    resultsDiv.style.display = 'none';
                    return;
                }
                
                timeoutId = setTimeout(() => {
                    buscarDocentes(query, resultsDiv, tableId);
                }, 300);
            });
            
            // Ocultar resultados al hacer click fuera
            document.addEventListener('click', function(e) {
                if (!searchInput.contains(e.target) && !resultsDiv.contains(e.target)) {
                    resultsDiv.style.display = 'none';
                }
            });
            
            docenteSearchListenersAdded[inputId] = true;
            console.log('✅ Event listener agregado correctamente para:', inputId);
        }
        
        // Función para buscar docentes
        function buscarDocentes(query, resultsDiv, tableId) {
            console.log('🔍 Buscando docentes:', query);
            
            // Buscar docentes reales desde la base de datos
            fetch(`/admin/docentes/buscar?q=${encodeURIComponent(query)}`)
                .then(response => {
                    if (!response.ok) {
                        throw new Error('Error en la respuesta del servidor');
                    }
                    return response.json();
                })
                .then(docentes => {
                    console.log('✅ Docentes encontrados:', docentes);
                    mostrarResultadosDocentes(docentes, resultsDiv, tableId);
                })
                .catch(error => {
                    console.error('❌ Error al buscar docentes:', error);
                    // Fallback con docentes simulados para desarrollo
                    const docentesSimulados = [
                        { id: 1, nombre: 'Dr. Juan Pérez', especialidad: 'Programación Java' },
                        { id: 2, nombre: 'Dra. María González', especialidad: 'Base de Datos' },
                        { id: 3, nombre: 'Ing. Carlos López', especialidad: 'Desarrollo Web' },
                        { id: 4, nombre: 'Dra. Ana Martínez', especialidad: 'Inteligencia Artificial' },
                        { id: 5, nombre: 'Ing. Roberto Silva', especialidad: 'Redes y Sistemas' }
                    ];
                    
                    const resultados = docentesSimulados.filter(docente => 
                        docente.nombre.toLowerCase().includes(query.toLowerCase()) ||
                        docente.especialidad.toLowerCase().includes(query.toLowerCase())
                    );
                    
                    mostrarResultadosDocentes(resultados, resultsDiv, tableId);
                });
        }
        
        // Función para mostrar resultados de búsqueda
        function mostrarResultadosDocentes(docentes, resultsDiv, tableId) {
            resultsDiv.innerHTML = '';
            
            if (docentes.length === 0) {
                resultsDiv.innerHTML = '<div class="no-results">No se encontraron docentes</div>';
                resultsDiv.style.display = 'block';
                return;
            }
            
            const ul = document.createElement('ul');
            ul.className = 'search-results-list';
            
            docentes.forEach(docente => {
                const li = document.createElement('li');
                li.className = 'search-result-item';
                li.innerHTML = `
                    <div class="docente-info">
                        <span class="docente-nombre">${docente.nombre}</span>
                    </div>
                    <button type="button" class="btn-add-docente" onclick="agregarDocente('${docente.id}', '${docente.nombre}', '${tableId}')">
                        <i class="fas fa-plus"></i>
                    </button>
                `;
                ul.appendChild(li);
            });
            
            resultsDiv.appendChild(ul);
            resultsDiv.style.display = 'block';
        }
        
        // Función para agregar docente a la tabla
        function agregarDocente(id, nombre, especialidad, tableId) {
            const tabla = document.getElementById(tableId);
            const tbody = tabla.querySelector('tbody');
            
            // Verificar si el docente ya está agregado
            const tipoSeccion = tableId.includes('formacion') ? 'formacion' : 'curso';
            const yaAgregado = docentesSeleccionados[tipoSeccion].find(d => d.id === id);
            
            if (yaAgregado) {
                alert('Este docente ya ha sido agregado');
                return;
            }
            
            // Agregar a la lista de seleccionados
            docentesSeleccionados[tipoSeccion].push({ id, nombre, especialidad });
            
            // Crear fila en la tabla
            const fila = document.createElement('tr');
            fila.innerHTML = `
                <td>${nombre}</td>
                <td>${especialidad}</td>
                <td>
                    <button type="button" class="btn-remove-docente" onclick="removerDocente(${id}, '${tableId}', this)">
                        <i class="fas fa-trash"></i>
                    </button>
                </td>
            `;
            
            tbody.appendChild(fila);
            
            // Ocultar resultados de búsqueda
            const resultsDiv = document.querySelector('.search-results:not([style*="display: none"])');
            if (resultsDiv) {
                resultsDiv.style.display = 'none';
            }
            
            // Limpiar campo de búsqueda
            const searchInput = tableId.includes('formacion') ? 
                document.getElementById('docente-search-formacion') : 
                document.getElementById('docente-search');
            if (searchInput) {
                searchInput.value = '';
            }
            
            console.log('✅ Docente agregado:', nombre);
        }
        
        // Función para remover docente
        function removerDocente(id, tableId, button) {
            const tipoSeccion = tableId.includes('formacion') ? 'formacion' : 'curso';
            
            // Remover de la lista
            docentesSeleccionados[tipoSeccion] = docentesSeleccionados[tipoSeccion].filter(d => d.id !== id);
            
            // Remover fila de la tabla
            const fila = button.closest('tr');
            fila.remove();
            
            console.log('❌ Docente removido');
        }
        
        // Array para almacenar categorías seleccionadas
        let categoriasSeleccionadas = [];
        
        // Función para añadir categoría seleccionada
        function añadirCategoriaSeleccionada() {
            const select = document.getElementById('categoria-select');
            const selectedValue = select.value;
            const selectedText = select.options[select.selectedIndex].text;
            
            if (!selectedValue || selectedValue === '') {
                alert('Por favor seleccione una categoría');
                return;
            }
            
            // Verificar si ya está seleccionada
            const yaSeleccionada = categoriasSeleccionadas.find(cat => cat.id === selectedValue);
            if (yaSeleccionada) {
                alert('Esta categoría ya ha sido seleccionada');
                return;
            }
            
            // Añadir a la lista
            categoriasSeleccionadas.push({
                id: selectedValue,
                nombre: selectedText
            });
            
            // Actualizar la visualización
            actualizarCategoriasChips();
            
            // Reset del select
            select.value = '';
            
            console.log('✅ Categoría añadida:', selectedText);
        }
        
        // Función para actualizar los chips de categorías
        function actualizarCategoriasChips() {
            const chipsContainer = document.getElementById('selected-chips');
            const selectedContainer = document.getElementById('selected-categories');
            
            if (!chipsContainer) return;
            
            // Limpiar chips existentes
            chipsContainer.innerHTML = '';
            
            if (categoriasSeleccionadas.length === 0) {
                selectedContainer.style.display = 'none';
                // Actualizar campo hidden del formulario
                const formCategorias = document.getElementById('categorias');
                if (formCategorias) {
                    formCategorias.value = '';
                }
                return;
            }
            
            // Mostrar contenedor
            selectedContainer.style.display = 'block';
            
            // Crear chips
            categoriasSeleccionadas.forEach((categoria, index) => {
                const chip = document.createElement('span');
                chip.className = 'categoria-chip';
                chip.dataset.categoriaId = categoria.id; // Agregar el data attribute
                chip.innerHTML = `
                    ${categoria.nombre}
                    <button type="button" class="chip-remove" onclick="removerCategoria(${index})">
                        <i class="fas fa-times"></i>
                    </button>
                `;
                chipsContainer.appendChild(chip);
            });
            
            // Actualizar el campo hidden del formulario principal con IDs separados por coma
            const formCategorias = document.getElementById('categorias');
            if (formCategorias) {
                const ids = categoriasSeleccionadas.map(cat => cat.id).join(',');
                formCategorias.value = ids;
                console.log('Categorías actualizadas:', ids);
            }
        }
        
        // Función para actualizar campo hidden de categorías
        function actualizarCategoriaHidden() {
            const categoriasSeleccionadas = Array.from(document.querySelectorAll('#selected-chips .categoria-chip'))
                .map(chip => chip.dataset.categoriaId);
            
            const formCategorias = document.getElementById('categorias');
            if (formCategorias) {
                formCategorias.value = categoriasSeleccionadas.join(',');
                console.log('Categorías actualizadas en hidden field:', formCategorias.value);
            }
        }
        
        // Función para actualizar campo hidden de certificado
        function actualizarCertificadoHidden() {
            const checkbox = document.getElementById('otorgaCertificado');
            const hiddenField = document.getElementById('otorgaCertificadoHidden');
            
            if (checkbox && hiddenField) {
                hiddenField.value = checkbox.checked ? 'true' : 'false';
                console.log('Certificado actualizado:', hiddenField.value);
            }
        }
        
        // Función para actualizar campos hidden de disertantes
        function actualizarDisertantesHidden(tipo) {
            const hiddenId = tipo === 'charla' ? 'disertantesCharlaHidden' : 'disertantesSeminarioHidden';
            const hiddenField = document.getElementById(hiddenId);
            
            if (hiddenField) {
                const lista = tipo === 'charla' ? disertantesCharla : disertantesSeminario;
                hiddenField.value = JSON.stringify(lista);
            }
        }
        
        // Función para actualizar campo hidden de horarios
        function actualizarHorariosHidden() {
            const hiddenField = document.getElementById('horarios');
            if (hiddenField) {
                hiddenField.value = JSON.stringify(horariosSeleccionados);
            }
        }
        
        // Función para remover categoría
        function removerCategoria(index) {
            categoriasSeleccionadas.splice(index, 1);
            actualizarCategoriasChips();
            console.log('❌ Categoría removida, total:', categoriasSeleccionadas.length);
        }
        
        // Funciones para gestión de categorías
        function cargarCategorias() {
            console.log('🔄 Cargando categorías...');
            
            const loadingDiv = document.getElementById('categoriasLoading');
            const errorDiv = document.getElementById('categoriasError');
            const table = document.getElementById('categoriasTable');
            
            if (loadingDiv) loadingDiv.style.display = 'block';
            if (errorDiv) errorDiv.style.display = 'none';
            if (table) table.style.display = 'none';
            
            fetch('/api/categorias')
                .then(response => response.json())
                .then(categorias => {
                    console.log('✅ Categorías cargadas:', categorias);
                    
                    if (loadingDiv) loadingDiv.style.display = 'none';
                    
                    mostrarCategorias(categorias);
                    if (table) table.style.display = 'table';
                })
                .catch(error => {
                    console.error('❌ Error:', error);
                    if (loadingDiv) loadingDiv.style.display = 'none';
                    mostrarError('Error de conexión al cargar categorías');
                });
        }
        
        function cargarCategoriasSelect() {
            console.log('🔄 Cargando categorías para select...');
            
            fetch('/api/categorias')
                .then(response => response.json())
                .then(categorias => {
                    const select = document.getElementById('categoria-select');
                    if (select) {
                        // Limpiar opciones existentes (excepto la primera)
                        while (select.children.length > 1) {
                            select.removeChild(select.lastChild);
                        }
                        
                        // Agregar categorías
                        categorias.forEach(categoria => {
                            const option = document.createElement('option');
                            option.value = categoria.idCategoria;
                            option.textContent = categoria.nombre;
                            select.appendChild(option);
                        });
                    }
                })
                .catch(error => {
                    console.error('❌ Error al cargar categorías para select:', error);
                });
        }
        
        function mostrarCategorias(categorias) {
            const tbody = document.getElementById('categoriasTableBody');
            const contador = document.getElementById('contadorCategorias');
            
            if (!tbody) return;
            
            tbody.innerHTML = '';
            
            if (categorias && categorias.length > 0) {
                categorias.forEach(categoria => {
                    const row = document.createElement('tr');
                    row.innerHTML = `
                        <td>${categoria.nombre}</td>
                        <td>${categoria.descripcion}</td>
                        <td class="text-center">
                            <button class="btn btn-sm btn-outline-primary me-1" onclick="editarCategoria(${categoria.idCategoria})" title="Editar">
                                <i class="fas fa-edit"></i>
                            </button>
                            <button class="btn btn-sm btn-outline-danger" onclick="eliminarCategoria(${categoria.idCategoria})" title="Eliminar">
                                <i class="fas fa-trash"></i>
                            </button>
                        </td>
                    `;
                    tbody.appendChild(row);
                });
                
                if (contador) {
                    contador.textContent = `Total: ${categorias.length} categorías`;
                }
            } else {
                const row = document.createElement('tr');
                row.innerHTML = '<td colspan="3" class="text-center text-muted">No hay categorías registradas</td>';
                tbody.appendChild(row);
                
                if (contador) {
                    contador.textContent = 'Total: 0 categorías';
                }
            }
        }
        
        function mostrarError(mensaje) {
            const errorDiv = document.getElementById('categoriasError');
            if (errorDiv) {
                errorDiv.textContent = mensaje;
                errorDiv.style.display = 'block';
            }
        }
        
        // Funciones globales para el modal
        window.categoriaModal = {
            hide: function() {
                const modal = document.getElementById('categoriaModal');
                if (modal) {
                    modal.style.display = 'none';
                }
            }
        };
        
        // Controlador de categorías
        window.categoriaController = {
            guardarCategoria: function() {
                console.log('💾 Guardando categoría...');
                
                const form = document.getElementById('categoriaForm');
                const formData = new FormData(form);
                
                const categoria = {
                    nombre: formData.get('categoriaNombre'),
                    descripcion: formData.get('categoriaDescripcion')
                };
                
                // Validaciones básicas
                if (!categoria.nombre || categoria.nombre.trim().length < 2) {
                    alert('El nombre debe tener al menos 2 caracteres');
                    return;
                }
                
                if (!categoria.descripcion || categoria.descripcion.trim().length < 5) {
                    alert('La descripción debe tener al menos 5 caracteres');
                    return;
                }
                
                fetch('/api/categorias', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(categoria)
                })
                .then(response => {
                    if (response.ok) {
                        return response.json();
                    } else {
                        throw new Error('Error en la respuesta del servidor');
                    }
                })
                .then(data => {
                    console.log('✅ Categoría guardada:', data);
                    form.reset();
                    cargarCategorias();
                    cargarCategoriasSelect();
                    alert('Categoría guardada exitosamente');
                })
                .catch(error => {
                    console.error('❌ Error:', error);
                    alert('Error al guardar categoría: ' + error.message);
                });
            },
            
            cancelarEdicion: function() {
                const form = document.getElementById('categoriaForm');
                if (form) {
                    form.reset();
                }
            }
        };
        
        // Funciones globales para botones
        window.editarCategoria = function(id) {
            console.log('✏️ Editando categoría:', id);
            // TODO: Implementar edición
        };
        
        window.eliminarCategoria = function(id) {
            console.log('🗑️ Eliminando categoría:', id);
            if (confirm('¿Estás seguro de que deseas eliminar esta categoría?')) {
                fetch(`/api/categorias/${id}`, {
                    method: 'DELETE'
                })
                .then(response => {
                    if (response.ok) {
                        console.log('✅ Categoría eliminada');
                        cargarCategorias();
                        cargarCategoriasSelect();
                        alert('Categoría eliminada exitosamente');
                    } else {
                        throw new Error('Error en la respuesta del servidor');
                    }
                })
                .catch(error => {
                    console.error('❌ Error:', error);
                    alert('Error al eliminar categoría: ' + error.message);
                });
            }
        };
        
        // Función global para remover categoría (accesible desde onclick)
        window.removerCategoria = function(index) {
            categoriasSeleccionadas.splice(index, 1);
            actualizarCategoriasChips();
            console.log('❌ Categoría removida, total:', categoriasSeleccionadas.length);
        };
        
        // Funciones globales para docentes (accesibles desde onclick)
        window.agregarDocente = function(id, nombre, tableId) {
            const tabla = document.getElementById(tableId);
            const tbody = tabla.querySelector('tbody');
            
            // Verificar si el docente ya está agregado
            const tipoSeccion = tableId.includes('formacion') ? 'formacion' : 'curso';
            const yaAgregado = docentesSeleccionados[tipoSeccion].find(d => d.id === id);
            
            if (yaAgregado) {
                alert('Este docente ya ha sido agregado');
                return;
            }
            
            // Agregar a la lista de seleccionados
            docentesSeleccionados[tipoSeccion].push({ id, nombre });
            
            // Crear fila en la tabla
            const fila = document.createElement('tr');
            fila.innerHTML = `
                <td>${nombre}</td>
                <td>
                    <button type="button" class="btn-remove-docente" onclick="removerDocente('${id}', '${tableId}', this)">
                        <i class="fas fa-trash"></i>
                    </button>
                </td>
            `;
            
            tbody.appendChild(fila);
            
            // Ocultar resultados de búsqueda
            const resultsDiv = document.querySelector('.search-results[style*="block"]');
            if (resultsDiv) {
                resultsDiv.style.display = 'none';
            }
            
            // Limpiar campo de búsqueda
            const searchInput = tableId.includes('formacion') ? 
                document.getElementById('docente-search-formacion') : 
                document.getElementById('docente-search');
            if (searchInput) {
                searchInput.value = '';
            }
            
            console.log('✅ Docente agregado:', nombre);
            
            // Actualizar campo hidden del formulario
            actualizarDocentesHidden(tipoSeccion);
            
            console.log('✅ Docente seleccionado:', docente);
        };
        
        window.removerDocente = function(id, tableId, button) {
            const tipoSeccion = tableId.includes('formacion') ? 'formacion' : 'curso';
            
            // Remover de la lista
            docentesSeleccionados[tipoSeccion] = docentesSeleccionados[tipoSeccion].filter(d => d.id !== id);
            
            // Remover fila de la tabla
            const fila = button.closest('tr');
            fila.remove();
            
            // Actualizar campo hidden del formulario
            actualizarDocentesHidden(tipoSeccion);
            
            console.log('❌ Docente removido');
        };
        
        // Función para actualizar campos hidden de docentes
        function actualizarDocentesHidden(tipoSeccion) {
            const fieldName = tipoSeccion === 'formacion' ? 'docentesFormacion' : 'docentesCurso';
            const hiddenField = document.getElementById(fieldName);
            
            if (hiddenField && docentesSeleccionados[tipoSeccion]) {
                const ids = docentesSeleccionados[tipoSeccion].map(d => d.id).join(',');
                hiddenField.value = ids;
                console.log(`🔄 Campo ${fieldName} actualizado:`, ids);
            }
        }

        // Variables globales para disertantes
        let disertantesCharla = [];
        let disertantesSeminario = [];

        // Función global para agregar disertante
        window.agregarDisertante = function(tipo) {
            const inputId = tipo === 'charla' ? 'disertantesCharlaInput' : 'disertantesSeminarioInput';
            const listId = tipo === 'charla' ? 'disertantes-charla-list' : 'disertantes-seminario-list';
            const hiddenId = tipo === 'charla' ? 'disertantesCharlaHidden' : 'disertantesSeminarioHidden';
            
            const input = document.getElementById(inputId);
            const nombre = input.value.trim();
            
            if (!nombre) {
                alert('Por favor ingrese el nombre del disertante');
                return;
            }
            
            // Verificar si ya existe
            const listaActual = tipo === 'charla' ? disertantesCharla : disertantesSeminario;
            if (listaActual.includes(nombre)) {
                alert('Este disertante ya ha sido agregado');
                return;
            }
            
            // Agregar a la lista
            if (tipo === 'charla') {
                disertantesCharla.push(nombre);
            } else {
                disertantesSeminario.push(nombre);
            }
            
            // Actualizar la visualización
            actualizarDisertantesChips(tipo);
            
            // Limpiar el input
            input.value = '';
            
            console.log('✅ Disertante agregado:', nombre);
        };

        // Función para actualizar los chips de disertantes
        function actualizarDisertantesChips(tipo) {
            const listId = tipo === 'charla' ? 'disertantes-charla-list' : 'disertantes-seminario-list';
            const hiddenId = tipo === 'charla' ? 'disertantesCharlaHidden' : 'disertantesSeminarioHidden';
            const lista = tipo === 'charla' ? disertantesCharla : disertantesSeminario;
            
            const container = document.getElementById(listId);
            const hiddenInput = document.getElementById(hiddenId);
            
            if (!container || !hiddenInput) {
                console.error('❌ Elementos no encontrados para tipo:', tipo);
                return;
            }
            
            // Limpiar contenedor
            container.innerHTML = '';
            
            // Crear chips
            lista.forEach((nombre, index) => {
                const chip = document.createElement('span');
                chip.className = 'categoria-chip';
                chip.innerHTML = `
                    ${nombre}
                    <button type="button" class="remove-chip" onclick="removerDisertante(${index}, '${tipo}')">
                        <i class="fas fa-times"></i>
                    </button>
                `;
                container.appendChild(chip);
            });
            
            // Actualizar input hidden
            hiddenInput.value = lista.join(',');
            
            console.log(`🔄 Chips actualizados para ${tipo}:`, lista.length);
        }

        // Función global para remover disertante
        window.removerDisertante = function(index, tipo) {
            if (tipo === 'charla') {
                disertantesCharla.splice(index, 1);
            } else {
                disertantesSeminario.splice(index, 1);
            }
            
            actualizarDisertantesChips(tipo);
            console.log('❌ Disertante removido');
        };

        // ================= GESTIÓN DE HORARIOS =================
        
        // Variable global para horarios
        let horariosSeleccionados = [];
        
        // Función global para agregar horario
        window.agregarHorario = function() {
            const dia = document.getElementById('dia-horario').value;
            const horaInicio = document.getElementById('hora-inicio').value;
            const horaFin = document.getElementById('hora-fin').value;
            
            // Validaciones
            if (!dia) {
                alert('Por favor seleccione un día');
                return;
            }
            
            if (!horaInicio || !horaFin) {
                alert('Por favor complete las horas de inicio y fin');
                return;
            }
            
            if (horaInicio >= horaFin) {
                alert('La hora de inicio debe ser anterior a la hora de fin');
                return;
            }
            
            // Verificar conflictos de horario
            const conflicto = horariosSeleccionados.find(h => 
                h.dia === dia && 
                ((horaInicio >= h.horaInicio && horaInicio < h.horaFin) ||
                 (horaFin > h.horaInicio && horaFin <= h.horaFin) ||
                 (horaInicio <= h.horaInicio && horaFin >= h.horaFin))
            );
            
            if (conflicto) {
                alert('Existe un conflicto de horario en el mismo día');
                return;
            }
            
            // Crear objeto horario
            const horario = {
                dia: dia,
                horaInicio: horaInicio,
                horaFin: horaFin
            };
            
            // Agregar a la lista
            horariosSeleccionados.push(horario);
            
            // Actualizar visualización
            actualizarHorariosChips();
            
            // Limpiar formulario
            document.getElementById('dia-horario').value = '';
            document.getElementById('hora-inicio').value = '';
            document.getElementById('hora-fin').value = '';
            
            console.log('✅ Horario agregado:', horario);
        };
        
        // Función para actualizar chips de horarios
        function actualizarHorariosChips() {
            const container = document.getElementById('lista-horarios');
            const hiddenInput = document.getElementById('horarios');
            
            // Limpiar contenedor
            container.innerHTML = '';
            
            if (horariosSeleccionados.length === 0) {
                container.innerHTML = '<p class="no-horarios">No hay horarios programados</p>';
                hiddenInput.value = '';
                return;
            }
            
            // Crear chips para cada horario
            horariosSeleccionados.forEach((horario, index) => {
                const chip = document.createElement('div');
                chip.className = 'horario-chip';
                chip.innerHTML = `
                    <div class="horario-info">
                        <strong>${horario.dia}</strong><br>
                        ${horario.horaInicio} - ${horario.horaFin}
                    </div>
                    <button type="button" class="remove-horario" onclick="removerHorario(${index})">
                        <i class="fas fa-times"></i>
                    </button>
                `;
                container.appendChild(chip);
            });
            
            // Actualizar input hidden con JSON
            hiddenInput.value = JSON.stringify(horariosSeleccionados);
            
            console.log('🔄 Horarios actualizados:', horariosSeleccionados.length);
        }
        
        // Función global para remover horario
        window.removerHorario = function(index) {
            horariosSeleccionados.splice(index, 1);
            actualizarHorariosChips();
            console.log('❌ Horario removido');
        };
        
        // ================= VALIDACIÓN Y ENVÍO DEL FORMULARIO =================
        
        // Función para validar formulario
        function validarFormulario(tipoOferta) {
            const titulo = document.getElementById('nombre').value.trim();
            const descripcion = document.getElementById('descripcion').value.trim();
            
            if (!titulo || !descripcion) {
                mostrarNotificacion('❌ Por favor complete el título y la descripción', 'error');
                return false;
            }
            
            // Validación de fechas obligatorias
            const fechaInicio = document.getElementById('fechaInicio').value;
            const fechaFin = document.getElementById('fechaFin').value;
            
            if (!fechaInicio) {
                mostrarNotificacion('❌ Por favor seleccione la fecha de inicio', 'error');
                return false;
            }
            
            if (!fechaFin) {
                mostrarNotificacion('❌ Por favor seleccione la fecha de fin', 'error');
                return false;
            }
            
            // Validar que la fecha de inicio no sea posterior a la fecha de fin
            if (new Date(fechaInicio) > new Date(fechaFin)) {
                mostrarNotificacion('❌ La fecha de inicio no puede ser posterior a la fecha de fin', 'error');
                return false;
            }
            
            // Validaciones específicas según tipo
            switch(tipoOferta) {
                case 'CURSO':
                case 'FORMACION':
                    if (horariosSeleccionados.length === 0) {
                        mostrarNotificacion('❌ Por favor agregue al menos un horario', 'error');
                        return false;
                    }
                    const tipoDocente = tipoOferta === 'CURSO' ? 'curso' : 'formacion';
                    if (!docentesSeleccionados[tipoDocente] || docentesSeleccionados[tipoDocente].length === 0) {
                        mostrarNotificacion('❌ Por favor seleccione al menos un docente', 'error');
                        return false;
                    }
                    break;
                    
                case 'CHARLA':
                    if (disertantesCharla.length === 0) {
                        mostrarNotificacion('❌ Por favor agregue al menos un disertante', 'error');
                        return false;
                    }
                    break;
                    
                case 'SEMINARIO':
                    if (disertantesSeminario.length === 0) {
                        mostrarNotificacion('❌ Por favor agregue al menos un disertante', 'error');
                        return false;
                    }
                    break;
            }
            
            return true;
        }
        
        // ================= ENVÍO AJAX Y NOTIFICACIONES =================
        
        // Función para enviar formulario con AJAX
        function enviarFormularioAjax() {
            console.log('🚀 Iniciando envío AJAX');
            
            const formulario = document.getElementById('oferta-form');
            const formData = new FormData(formulario);
            
            // Debug: mostrar datos del formulario
            console.log('📋 Datos del formulario:');
            for (let [key, value] of formData.entries()) {
                console.log(`  ${key}: ${value}`);
            }
            
            // Mostrar loading en el botón
            const btnSubmit = formulario.querySelector('button[type="submit"]');
            const textoOriginal = btnSubmit.innerHTML;
            btnSubmit.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Registrando...';
            btnSubmit.disabled = true;
            
            console.log('📡 Enviando request a /admin/ofertas/registrar');
            
            fetch('/admin/ofertas/registrar', {
                method: 'POST',
                body: formData
            })
            .then(response => {
                console.log('📥 Respuesta recibida:', response.status);
                return response.json();
            })
            .then(data => {
                console.log('📊 Datos de respuesta:', data);
                
                if (data.success) {
                    console.log('✅ Registro exitoso');
                    // Mostrar notificación de éxito
                    mostrarNotificacion('✅ ' + data.message, 'success');
                    
                    // Limpiar formulario
                    limpiarFormularioCompleto();
                    
                    // Cerrar formulario después de un momento
                    setTimeout(() => {
                        cerrarFormulario();
                    }, 1500);
                    
                    // Actualizar tabla de ofertas
                    actualizarTablaOfertas();
                    
                } else {
                    console.log('❌ Error en registro:', data.message);
                    mostrarNotificacion('❌ ' + data.message, 'error');
                }
            })
            .catch(error => {
                console.error('❌ Error en fetch:', error);
                mostrarNotificacion('❌ Error al registrar la oferta. Inténtelo nuevamente.', 'error');
            })
            .finally(() => {
                // Restaurar botón
                btnSubmit.innerHTML = textoOriginal;
                btnSubmit.disabled = false;
            });
        }
        
        // Función para mostrar notificaciones
        function mostrarNotificacion(mensaje, tipo = 'success') {
            const notificationArea = document.getElementById('notification-area');
            const notification = document.getElementById('notification');
            const notificationIcon = document.getElementById('notification-icon');
            const notificationMessage = document.getElementById('notification-message');
            
            // Configurar icono según tipo
            let iconClass = 'fas fa-check-circle';
            if (tipo === 'error') {
                iconClass = 'fas fa-exclamation-circle';
            } else if (tipo === 'warning') {
                iconClass = 'fas fa-exclamation-triangle';
            }
            
            notificationIcon.className = iconClass;
            notificationMessage.textContent = mensaje;
            
            // Limpiar clases anteriores y agregar nueva
            notification.className = `notification notification-${tipo}`;
            
            // Mostrar notificación
            notificationArea.style.display = 'block';
            setTimeout(() => {
                notification.classList.add('show');
            }, 10);
            
            // Auto-ocultar después de 5 segundos
            setTimeout(() => {
                ocultarNotificacion();
            }, 5000);
        }
        
        // Función para ocultar notificación
        function ocultarNotificacion() {
            const notificationArea = document.getElementById('notification-area');
            const notification = document.getElementById('notification');
            
            notification.classList.remove('show');
            setTimeout(() => {
                notificationArea.style.display = 'none';
            }, 300);
        }
        
        // Función para limpiar formulario completo
        function limpiarFormularioCompleto() {
            const formulario = document.getElementById('oferta-form');
            formulario.reset();
            
            // Limpiar datos específicos
            limpiarDatosFormulario();
            
            // Ocultar todas las secciones específicas
            const seccionesEspecificas = document.querySelectorAll('.tipo-specific');
            seccionesEspecificas.forEach(seccion => {
                seccion.style.display = 'none';
            });
            
            // Ocultar sección de horarios
            const seccionHorarios = document.getElementById('seccion-horarios');
            if (seccionHorarios) {
                seccionHorarios.style.display = 'none';
            }
            
            console.log('🧹 Formulario limpiado completamente');
        }
        
        // Función para cerrar formulario
        function cerrarFormulario() {
            const formContainer = document.getElementById('form-container');
            if (formContainer) {
                formContainer.classList.remove('show');
                setTimeout(() => {
                    formContainer.style.display = 'none';
                }, 500);
            }
        }
        
        // Función para actualizar tabla de ofertas
        function actualizarTablaOfertas() {
            console.log('📊 Actualizando tabla de ofertas...');
            fetch('/admin/ofertas/listar')
                .then(response => response.json())
                .then(data => {
                    console.log('📥 Respuesta del servidor:', data);
                    if (data.success && data.data) {
                        actualizarTablaConDatos(data.data);
                        actualizarContadorOfertas(data.data.length);
                        console.log('✅ Tabla actualizada con', data.data.length, 'ofertas');
                    }
                })
                .catch(error => {
                    console.error('❌ Error al actualizar tabla:', error);
                });
        }
        
        // Función para actualizar tabla con nuevos datos
        function actualizarTablaConDatos(ofertas) {
            console.log('🔄 Actualizando tabla con', ofertas.length, 'ofertas');
            const tbody = document.querySelector('#ofertas-table tbody');
            if (!tbody) {
                console.log('❌ No se encontró tbody de la tabla');
                return;
            }
            
            tbody.innerHTML = '';
            
            if (ofertas.length === 0) {
                tbody.innerHTML = `
                    <tr>
                        <td colspan="8" class="text-center text-muted py-4">
                            <i class="fas fa-inbox fa-2x mb-2"></i><br>
                            No hay ofertas académicas registradas
                        </td>
                    </tr>
                `;
                return;
            }
            
            ofertas.forEach((oferta, index) => {
                console.log(`📋 Procesando oferta ${index + 1}:`, oferta.nombre);
                const fila = document.createElement('tr');
                fila.innerHTML = `
                    <td>${oferta.nombre || '-'}</td>
                    <td>${oferta.tipoOferta || '-'}</td>
                    <td>${oferta.modalidad || '-'}</td>
                    <td class="cupos-cell">
                        ${oferta.cupos ? 
                            `<span class="cupos-disponibles">${oferta.cupos}</span>` : 
                            '<span class="cupos-ilimitados">∞</span>'
                        }
                    </td>
                    <td>${oferta.fechaInicio ? formatearFecha(oferta.fechaInicio) : '-'}</td>
                    <td>${oferta.fechaFin ? formatearFecha(oferta.fechaFin) : '-'}</td>
                    <td><span class="estado-badge">${oferta.estado || 'ACTIVA'}</span></td>
                    <td class="acciones-cell">
                        <button class="btn-accion btn-ver" title="Ver información" data-id="${oferta.idOferta}" onclick="verDetalleOferta(${oferta.idOferta})">
                            <i class="fas fa-eye"></i>
                        </button>
                        <button class="btn-accion btn-modificar" title="Modificar" data-id="${oferta.idOferta}" onclick="modificarOferta(${oferta.idOferta})">
                            <i class="fas fa-edit"></i>
                        </button>
                    </td>
                `;
                tbody.appendChild(fila);
            });
        }        
        // Función para actualizar contador de ofertas
        function actualizarContadorOfertas(total) {
            const contador = document.getElementById('total-ofertas');
            if (contador) {
                contador.textContent = total;
            }
        }

        // ================= FUNCIONES PARA EL MODAL DE DETALLE =================
        
        // Variable global para almacenar el ID de la oferta actual
        let ofertaActualId = null;

        // Función global para abrir modal de detalle
        window.verDetalleOferta = function(id) {
            console.log('📋 FUNCIÓN verDetalleOferta EJECUTADA con ID:', id);
            console.log('- Tipo de ID:', typeof id);
            
            if (!id) {
                console.error('❌ ID de oferta no válido:', id);
                mostrarNotificacion('ID de oferta no válido', 'error');
                return;
            }
            
            ofertaActualId = id;
            console.log('- ID almacenado:', ofertaActualId);
            
            // Obtener datos de la oferta desde el servidor
            console.log('🔗 Realizando fetch a:', `/admin/ofertas/${id}`);
            fetch(`/admin/ofertas/${id}`)
                .then(response => {
                    console.log('📡 Respuesta recibida:', response.status, response.statusText);
                    if (!response.ok) {
                        throw new Error(`Error ${response.status}: ${response.statusText}`);
                    }
                    return response.json();
                })
                .then(data => {
                    console.log('✅ Datos de la oferta recibidos:', data);
                    
                    // Verificar estructura de la respuesta
                    if (data.success && data.oferta) {
                        console.log('📋 Estructura correcta - cargando en modal...');
                        cargarDatosEnModal(data.oferta);
                    } else if (data.oferta) {
                        console.log('📋 Datos directos - cargando en modal...');
                        cargarDatosEnModal(data.oferta);
                    } else if (data) {
                        console.log('📋 Datos directos (sin wrapper) - cargando en modal...');
                        cargarDatosEnModal(data);
                    } else {
                        console.error('❌ Estructura de respuesta no reconocida:', data);
                        mostrarNotificacion('Error: Estructura de datos no válida', 'error');
                    }
                    
                    // Mostrar el modal después de cargar los datos
                    const modal = document.getElementById('modalDetalleOferta');
                    if (modal) {
                        modal.style.display = 'flex';
                        document.body.style.overflow = 'hidden';
                        console.log('📱 Modal mostrado');
                    } else {
                        console.error('❌ Modal modalDetalleOferta no encontrado');
                    }
                })
                .catch(error => {
                    console.error('❌ Error al cargar detalle de la oferta:', error);
                    mostrarNotificacion('Error al cargar los datos de la oferta', 'error');
                });
        };

        // Función para cargar datos en el modal
        function cargarDatosEnModal(oferta) {
            console.log('🔄 Cargando datos en el modal:', oferta);
            console.log('📊 Propiedades disponibles:', Object.keys(oferta));
            console.log('📝 Valores de campos clave:');
            console.log('  - nombre:', oferta.nombre);
            console.log('  - descripcion:', oferta.descripcion); 
            console.log('  - tipo:', oferta.tipo);
            console.log('  - modalidad:', oferta.modalidad);
            console.log('  - estado:', oferta.estado);
            console.log('  - costoInscripcion:', oferta.costoInscripcion);
            console.log('  - cupos:', oferta.cupos);
            console.log('  - certificado:', oferta.certificado);
            
            // Verificar si oferta tiene datos
            if (!oferta) {
                console.error('❌ Objeto oferta está vacío o undefined');
                return;
            }
            
            // Información general - verificar que los elementos existen antes de asignar
            const nombre = oferta.nombre || '-';
            const nombreElement = document.getElementById('detalle-nombre');
            if (nombreElement) {
                nombreElement.textContent = nombre;
                console.log('✅ Nombre asignado:', nombre);
            } else {
                console.error('❌ Elemento detalle-nombre no encontrado');
            }
            
            const tipo = oferta.tipo || '-';
            const tipoElement = document.getElementById('detalle-tipo');
            if (tipoElement) {
                tipoElement.textContent = tipo;
                tipoElement.className = `badge tipo-${tipo}`;
                console.log('✅ Tipo asignado:', tipo);
            } else {
                console.error('❌ Elemento detalle-tipo no encontrado');
            }
            
            const modalidad = oferta.modalidad || '-';
            const modalidadElement = document.getElementById('detalle-modalidad');
            if (modalidadElement) {
                modalidadElement.textContent = modalidad;
                modalidadElement.className = `badge modalidad-${modalidad}`;
                console.log('✅ Modalidad asignada:', modalidad);
            } else {
                console.error('❌ Elemento detalle-modalidad no encontrado');
            }
            
            const estado = oferta.estado || '-';
            const estadoElement = document.getElementById('detalle-estado');
            if (estadoElement) {
                estadoElement.textContent = estado;
                estadoElement.className = `badge estado-${estado}`;
                console.log('✅ Estado asignado:', estado);
            } else {
                console.error('❌ Elemento detalle-estado no encontrado');
            }
            
            // Descripción
            const descripcion = oferta.descripcion || 'Sin descripción disponible';
            const descripcionElement = document.getElementById('detalle-descripcion');
            if (descripcionElement) {
                descripcionElement.innerHTML = descripcion;
                console.log('✅ Descripción asignada:', descripcion ? 'Disponible' : 'No disponible');
            } else {
                console.error('❌ Elemento detalle-descripcion no encontrado');
            }
            
            // Usar costoInscripcion que es el campo real de CursoDetalle
            const costo = oferta.costoInscripcion || oferta.costo || 0;
            const costoElement = document.getElementById('detalle-costo');
            if (costoElement) {
                costoElement.textContent = costo ? `$${costo.toLocaleString()}` : '-';
                console.log('✅ Costo asignado:', costo);
            } else {
                console.error('❌ Elemento detalle-costo no encontrado');
            }
            
            // Fechas - usar los nombres exactos de LocalDate
            const fechaInicio = formatearFecha(oferta.fechaInicio) || '-';
            const fechaInicioElement = document.getElementById('detalle-fecha-inicio');
            if (fechaInicioElement) {
                fechaInicioElement.textContent = fechaInicio;
                console.log('✅ Fecha inicio asignada:', fechaInicio);
            } else {
                console.error('❌ Elemento detalle-fecha-inicio no encontrado');
            }
            
            const fechaFin = formatearFecha(oferta.fechaFin) || '-';
            const fechaFinElement = document.getElementById('detalle-fecha-fin');
            if (fechaFinElement) {
                fechaFinElement.textContent = fechaFin;
                console.log('✅ Fecha fin asignada:', fechaFin);
            } else {
                console.error('❌ Elemento detalle-fecha-fin no encontrado');
            }
            
            // Para fechas de inscripción, pueden no estar en CursoDetalle
            const fechaInscripcionElement = document.getElementById('detalle-fecha-inscripcion');
            if (fechaInscripcionElement) fechaInscripcionElement.textContent = '-';
            
            const fechaLimiteElement = document.getElementById('detalle-fecha-limite');
            if (fechaLimiteElement) fechaLimiteElement.textContent = '-';
            
            // Capacidad - usar cupos que es el campo real
            const cupos = oferta.cupos || '-';
            const capacidadMinElement = document.getElementById('detalle-capacidad-min');
            if (capacidadMinElement) capacidadMinElement.textContent = '-'; // No disponible en CursoDetalle
            
            const capacidadMaxElement = document.getElementById('detalle-capacidad-max');
            if (capacidadMaxElement) {
                capacidadMaxElement.textContent = cupos;
                console.log('✅ Cupos asignados:', cupos);
            } else {
                console.error('❌ Elemento detalle-capacidad-max no encontrado');
            }
            
            // Categorías
            const categoriasContainer = document.getElementById('detalle-categorias');
            if (categoriasContainer) {
                if (oferta.categorias && oferta.categorias.length > 0) {
                    categoriasContainer.innerHTML = oferta.categorias.map(cat => 
                        `<span class="categoria-chip">${cat}</span>`
                    ).join('');
                } else {
                    categoriasContainer.innerHTML = '<span class="text-muted">Sin categorías</span>';
                }
            }
            
            // Imagen
            const imagenElement = document.getElementById('detalle-imagen');
            const sinImagenElement = document.getElementById('detalle-sin-imagen');
            if (imagenElement && sinImagenElement) {
                if (oferta.imagen) {
                    imagenElement.src = oferta.imagen;
                    imagenElement.style.display = 'block';
                    sinImagenElement.style.display = 'none';
                } else {
                    imagenElement.style.display = 'none';
                    sinImagenElement.style.display = 'flex';
                }
            }
            
            // Certificación
            const certificado = oferta.certificado;
            const seccionCertificacion = document.getElementById('seccion-certificacion');
            if (seccionCertificacion) {
                if (certificado === true || certificado === 'true' || certificado === 'Sí') {
                    seccionCertificacion.style.display = 'block';
                    const certificadoElement = document.getElementById('detalle-otorga-certificado');
                    if (certificadoElement) certificadoElement.textContent = 'Sí';
                } else {
                    seccionCertificacion.style.display = 'none';
                }
            }
            
            // Mostrar datos específicos según el tipo
            mostrarDatosEspecificosPorTipo(oferta, tipo);
            
            // Configurar botón de estado
            configurarBotonEstado(estado);
            
            console.log('✅ Carga de datos en modal completada');
        }
        
        // Función para mostrar datos específicos según el tipo
        function mostrarDatosEspecificosPorTipo(oferta, tipo) {
            // Ocultar todas las secciones específicas por tipo
            document.querySelectorAll('.tipo-especifico').forEach(seccion => {
                seccion.style.display = 'none';
            });
            
            switch (tipo) {
                case 'CURSO':
                    mostrarDatosCurso(oferta);
                    break;
                case 'FORMACION':
                    mostrarDatosFormacion(oferta);
                    break;
                case 'CHARLA':
                    mostrarDatosCharla(oferta);
                    break;
                case 'SEMINARIO':
                    mostrarDatosSeminario(oferta);
                    break;
                default:
                    console.log('⚠️ Tipo de oferta no reconocido:', tipo);
            }
        }
        
        // Funciones para mostrar datos específicos por tipo
        function mostrarDatosCurso(oferta) {
            const seccion = document.getElementById('datos-curso');
            seccion.style.display = 'block';
            
            document.getElementById('detalle-curso-costo-cuota').textContent = 
                oferta.costoCuota ? `$${oferta.costoCuota.toLocaleString()}` : '-';
            document.getElementById('detalle-curso-nro-cuotas').textContent = oferta.nrCuotas || '-';
            document.getElementById('detalle-curso-costo-mora').textContent = 
                oferta.costoMora ? `$${oferta.costoMora.toLocaleString()}` : '-';
            document.getElementById('detalle-curso-dia-vencimiento').textContent = oferta.diaVencimiento || '-';
            
            // Docentes
            const docentesContainer = document.getElementById('detalle-curso-docentes');
            if (oferta.docentes && oferta.docentes.length > 0) {
                docentesContainer.innerHTML = oferta.docentes.map(docente => `
                    <div class="docente-item">
                        <i class="fas fa-user-tie"></i>
                        <div class="docente-info">
                            <div class="docente-nombre">${docente.nombre} ${docente.apellido || ''}</div>
                            <div class="docente-especialidad">${docente.especialidad || 'Sin especialidad'}</div>
                        </div>
                    </div>
                `).join('');
            } else {
                docentesContainer.innerHTML = '<span class="text-muted">Sin docentes asignados</span>';
            }
            
            // Horarios (si están disponibles)
            const horariosContainer = document.getElementById('detalle-curso-horarios');
            if (oferta.horarios && oferta.horarios.length > 0) {
                horariosContainer.innerHTML = oferta.horarios.map(horario => `
                    <div class="horario-item">
                        <i class="fas fa-clock"></i>
                        <span class="horario-dia">${horario.dia}</span>
                        <span class="horario-horas">${horario.horaInicio} - ${horario.horaFin}</span>
                    </div>
                `).join('');
            } else {
                horariosContainer.innerHTML = '<span class="text-muted">Sin horarios definidos</span>';
            }
            
            console.log('📚 Datos de curso cargados');
        }
        
        function mostrarDatosFormacion(oferta) {
            const seccion = document.getElementById('datos-formacion');
            seccion.style.display = 'block';
            
            document.getElementById('detalle-formacion-costo-cuota').textContent = 
                oferta.costoCuota ? `$${oferta.costoCuota.toLocaleString()}` : '-';
            document.getElementById('detalle-formacion-nro-cuotas').textContent = oferta.nrCuotas || '-';
            document.getElementById('detalle-formacion-costo-mora').textContent = 
                oferta.costoMora ? `$${oferta.costoMora.toLocaleString()}` : '-';
            document.getElementById('detalle-formacion-dia-vencimiento').textContent = oferta.diaVencimiento || '-';
            
            // Docentes
            const docentesContainer = document.getElementById('detalle-formacion-docentes');
            if (oferta.docentes && oferta.docentes.length > 0) {
                docentesContainer.innerHTML = oferta.docentes.map(docente => `
                    <div class="docente-item">
                        <i class="fas fa-user-tie"></i>
                        <div class="docente-info">
                            <div class="docente-nombre">${docente.nombre} ${docente.apellido || ''}</div>
                            <div class="docente-especialidad">${docente.especialidad || 'Sin especialidad'}</div>
                        </div>
                    </div>
                `).join('');
            } else {
                docentesContainer.innerHTML = '<span class="text-muted">Sin docentes asignados</span>';
            }
            
            // Horarios
            const horariosContainer = document.getElementById('detalle-formacion-horarios');
            if (oferta.horarios && oferta.horarios.length > 0) {
                horariosContainer.innerHTML = oferta.horarios.map(horario => `
                    <div class="horario-item">
                        <i class="fas fa-clock"></i>
                        <span class="horario-dia">${horario.dia}</span>
                        <span class="horario-horas">${horario.horaInicio} - ${horario.horaFin}</span>
                    </div>
                `).join('');
            } else {
                horariosContainer.innerHTML = '<span class="text-muted">Sin horarios definidos</span>';
            }
            
            console.log('🎓 Datos de formación cargados');
        }
        
        function mostrarDatosCharla(oferta) {
            const seccion = document.getElementById('datos-charla');
            seccion.style.display = 'block';
            
            const disertantesContainer = document.getElementById('detalle-charla-disertantes');
            if (oferta.disertantes && oferta.disertantes.length > 0) {
                disertantesContainer.innerHTML = oferta.disertantes.map(disertante => `
                    <div class="disertante-item">
                        <i class="fas fa-microphone"></i>
                        <div class="disertante-info">
                            <div class="disertante-nombre">${disertante}</div>
                        </div>
                    </div>
                `).join('');
            } else {
                disertantesContainer.innerHTML = '<span class="text-muted">Sin disertantes asignados</span>';
            }
            
            console.log('🎤 Datos de charla cargados');
        }
        
        function mostrarDatosSeminario(oferta) {
            const seccion = document.getElementById('datos-seminario');
            seccion.style.display = 'block';
            
            const disertantesContainer = document.getElementById('detalle-seminario-disertantes');
            if (oferta.disertantes && oferta.disertantes.length > 0) {
                disertantesContainer.innerHTML = oferta.disertantes.map(disertante => `
                    <div class="disertante-item">
                        <i class="fas fa-chalkboard-teacher"></i>
                        <div class="disertante-info">
                            <div class="disertante-nombre">${disertante}</div>
                        </div>
                    </div>
                `).join('');
            } else {
                disertantesContainer.innerHTML = '<span class="text-muted">Sin disertantes asignados</span>';
            }
            
            console.log('🏛️ Datos de seminario cargados');
        }
        
        // Función para configurar botón de estado
        function configurarBotonEstado(estado) {
            const btnCambiarEstado = document.getElementById('btn-cambiar-estado');
            const iconEstado = document.getElementById('icon-estado');
            const textEstado = document.getElementById('text-estado');
            
            console.log('🎯 Configurando botón para estado:', estado);
            
            if (btnCambiarEstado && iconEstado && textEstado) {
                if (estado === 'ACTIVA') {
                    btnCambiarEstado.className = 'btn-danger';  // Rojo para dar de baja
                    iconEstado.className = 'fas fa-times-circle';
                    textEstado.textContent = 'Dar de Baja';
                    console.log('🔴 Botón configurado para dar de baja');
                } else {
                    btnCambiarEstado.className = 'btn-success';  // Verde para dar de alta
                    iconEstado.className = 'fas fa-check-circle';
                    textEstado.textContent = 'Dar de Alta';
                    console.log('🟢 Botón configurado para dar de alta');
                }
            } else {
                console.error('❌ No se pudieron encontrar los elementos del botón de estado');
                console.log('Elementos encontrados:', {
                    btnCambiarEstado: !!btnCambiarEstado,
                    iconEstado: !!iconEstado,
                    textEstado: !!textEstado
                });
            }
        }
        
        // Función global para cerrar modal
        window.cerrarModalDetalle = function() {
            const modal = document.getElementById('modalDetalleOferta');
            if (modal) {
                modal.style.display = 'none';
                document.body.style.overflow = 'auto';
                ofertaActualId = null;
                console.log('🔚 Modal cerrado');
            }
        };
        
        // Función para cambiar estado de la oferta
        window.cambiarEstadoOferta = function() {
            if (!ofertaActualId) {
                console.error('❌ No hay oferta seleccionada para cambiar estado');
                mostrarNotificacion('Error: No hay oferta seleccionada', 'error');
                return;
            }
            
            console.log('🔄 Cambiando estado de oferta con ID:', ofertaActualId);
            
            // Obtener elementos del DOM
            const btnCambiarEstado = document.getElementById('btn-cambiar-estado');
            const iconEstado = document.getElementById('icon-estado');
            const textEstado = document.getElementById('text-estado');
            
            // Verificar que los elementos existen
            if (!btnCambiarEstado || !iconEstado || !textEstado) {
                console.error('❌ No se encontraron los elementos del botón');
                console.log('Elementos encontrados:', {
                    btnCambiarEstado: !!btnCambiarEstado,
                    iconEstado: !!iconEstado,
                    textEstado: !!textEstado
                });
                mostrarNotificacion('Error: Elementos del botón no encontrados', 'error');
                return;
            }
            
            // Deshabilitar botón durante la operación
            const textoOriginal = btnCambiarEstado.innerHTML;
            btnCambiarEstado.disabled = true;
            btnCambiarEstado.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Procesando...';
            
            // Realizar petición al servidor
            fetch(`/admin/ofertas/cambiar-estado/${ofertaActualId}`, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    'X-Requested-With': 'XMLHttpRequest'
                }
            })
            .then(response => {
                console.log('📡 Respuesta del servidor:', response.status);
                // No lanzar error aquí, siempre procesar la respuesta JSON
                return response.json();
            })
            .then(data => {
                console.log('✅ Respuesta procesada:', data);
                console.log('📋 Detalles de la respuesta:', {
                    success: data.success,
                    message: data.message,
                    motivo: data.motivo,
                    nuevoEstado: data.nuevoEstado
                });
                
                if (data.success) {
                    console.log('🎉 Estado cambiado exitosamente a:', data.nuevoEstado);
                    
                    // Actualizar interfaz del botón según el nuevo estado
                    if (data.nuevoEstado === 'ACTIVA') {
                        btnCambiarEstado.className = 'btn-danger';  // Rojo para dar de baja
                        iconEstado.className = 'fas fa-times-circle';
                        textEstado.textContent = 'Dar de Baja';
                    } else {
                        btnCambiarEstado.className = 'btn-success';  // Verde para dar de alta
                        iconEstado.className = 'fas fa-check-circle';
                        textEstado.textContent = 'Dar de Alta';
                    }
                    
                    // Actualizar badge de estado en el modal
                    const estadoElement = document.getElementById('detalle-estado');
                    if (estadoElement) {
                        estadoElement.textContent = data.nuevoEstado;
                        estadoElement.className = `badge estado-${data.nuevoEstado}`;
                    }
                    
                    // Mostrar notificación de éxito
                    const mensaje = data.nuevoEstado === 'ACTIVA' ? 
                        'Oferta activada correctamente' : 
                        'Oferta dada de baja correctamente';
                    mostrarNotificacion(mensaje, 'success');
                    
                    console.log('🔄 Estado actualizado en la interfaz');
                } else {
                    console.error('❌ Error del servidor:', data.message || 'Error desconocido');
                    console.log('🔍 Motivo del error:', data.motivo);
                    console.log('🔍 Datos completos del error:', data);
                    
                    // Crear mensaje detallado para alert
                    let mensajeDetallado = data.message || 'Error al cambiar estado';
                    if (data.motivo) {
                        switch(data.motivo) {
                            case 'VALIDACION_BAJA':
                                mensajeDetallado += '\n\nMotivo: La oferta tiene inscripciones activas';
                                mensajeDetallado += '\n\nSugerencias:';
                                mensajeDetallado += '\n- Cancela las inscripciones activas primero';
                                mensajeDetallado += '\n- O edita la oferta para cambiar las fechas';
                                mensajeDetallado += '\n- Espera a que termine la oferta naturalmente';
                                break;
                            case 'ESTADO_FINAL':
                                mensajeDetallado += '\n\nMotivo: La fecha de finalización ya pasó';
                                mensajeDetallado += '\n\nSugerencias:';
                                mensajeDetallado += '\n- Las ofertas finalizadas no pueden cambiar de estado';
                                mensajeDetallado += '\n- Crea una nueva oferta similar si necesitas reactivarla';
                                break;
                            case 'ERROR_SERVIDOR':
                                mensajeDetallado += '\n\nMotivo: Error interno del servidor';
                                mensajeDetallado += '\n\nSugerencias:';
                                mensajeDetallado += '\n- Intenta nuevamente en unos segundos';
                                mensajeDetallado += '\n- Si persiste, contacta al administrador';
                                break;
                            default:
                                if (data.motivo !== 'ERROR_GENERAL') {
                                    mensajeDetallado += '\n\nMotivo: ' + data.motivo;
                                }
                        }
                    }
                    
                    // Mostrar el mensaje detallado
                    alert(mensajeDetallado);
                    
                    // Restaurar botón original
                    btnCambiarEstado.innerHTML = textoOriginal;
                }
            })
            .catch(error => {
                console.error('❌ Error en la petición:', error);
                
                // Mensaje de error más simple
                alert('Error de conexión al cambiar el estado de la oferta\n\nIntenta nuevamente en unos segundos.');
                
                // Restaurar botón original
                btnCambiarEstado.innerHTML = textoOriginal;
            })
            .finally(() => {
                // Siempre rehabilitar el botón
                btnCambiarEstado.disabled = false;
            });
        };
        
        // Función para mostrar modal de error con motivo específico
        window.mostrarModalError = function(mensaje, tipoError) {
            console.log('🚨 Mostrando modal de error:', mensaje, tipoError);
            
            const modal = document.getElementById('modalErrorEstado');
            const errorIcon = document.getElementById('error-icon');
            const errorTitle = document.getElementById('error-title');
            const errorDescription = document.getElementById('error-description');
            const errorSuggestions = document.getElementById('error-suggestions');
            const errorSuggestionsList = document.getElementById('error-suggestions-list');
            
            if (!modal || !errorTitle || !errorDescription) {
                console.error('❌ Elementos del modal de error no encontrados');
                // Fallback a alert simple
                alert('Error: ' + mensaje + '\n\nMotivo: ' + tipoError);
                return;
            }
            
            // Configurar contenido según el tipo de error
            let mensajeFinal = mensaje;
            switch(tipoError) {
                case 'VALIDACION_BAJA':
                    errorIcon.className = 'fas fa-users text-warning';
                    errorTitle.textContent = 'No se puede dar de baja la oferta';
                    errorDescription.textContent = mensaje;
                    mensajeFinal = mensaje + ' (La oferta tiene inscripciones activas)';
                    
                    // Mostrar sugerencias específicas
                    if (errorSuggestions) {
                        errorSuggestions.style.display = 'block';
                        errorSuggestionsList.innerHTML = `
                            <li><i class="fas fa-user-minus"></i> Cancela las inscripciones activas primero</li>
                            <li><i class="fas fa-edit"></i> O edita la oferta para cambiar las fechas</li>
                            <li><i class="fas fa-clock"></i> Espera a que termine la oferta naturalmente</li>
                        `;
                    }
                    break;
                    
                case 'ESTADO_FINAL':
                    errorIcon.className = 'fas fa-flag text-danger';
                    errorTitle.textContent = 'Oferta en estado final';
                    errorDescription.textContent = mensaje;
                    mensajeFinal = mensaje + ' (La fecha de finalización ya pasó)';
                    
                    if (errorSuggestions) {
                        errorSuggestions.style.display = 'block';
                        errorSuggestionsList.innerHTML = `
                            <li><i class="fas fa-info-circle"></i> Las ofertas finalizadas o canceladas no pueden cambiar de estado</li>
                            <li><i class="fas fa-plus"></i> Crea una nueva oferta similar si necesitas reactivarla</li>
                        `;
                    }
                    break;
                    
                case 'ERROR_SERVIDOR':
                    errorIcon.className = 'fas fa-server text-danger';
                    errorTitle.textContent = 'Error del sistema';
                    errorDescription.textContent = mensaje;
                    mensajeFinal = mensaje + ' (Error interno del servidor)';
                    
                    if (errorSuggestions) {
                        errorSuggestions.style.display = 'block';
                        errorSuggestionsList.innerHTML = `
                            <li><i class="fas fa-refresh"></i> Intenta nuevamente en unos segundos</li>
                            <li><i class="fas fa-phone"></i> Si el problema persiste, contacta al administrador</li>
                        `;
                    }
                    break;
                    
                default:
                    errorIcon.className = 'fas fa-exclamation-triangle text-warning';
                    errorTitle.textContent = 'Error';
                    errorDescription.textContent = mensaje;
                    mensajeFinal = mensaje;
                    if (errorSuggestions) {
                        errorSuggestions.style.display = 'none';
                    }
                    break;
            }
            
            // Intentar mostrar el modal, usar alert como fallback
            try {
                modal.style.display = 'flex';
                document.body.style.overflow = 'hidden';
                console.log('✅ Modal de error mostrado');
            } catch (e) {
                console.error('❌ Error mostrando modal, usando alert:', e);
                alert('Error: ' + mensajeFinal);
            }
        };
        
        // Función para cerrar modal de error
        window.cerrarModalError = function() {
            const modal = document.getElementById('modalErrorEstado');
            if (modal) {
                modal.style.display = 'none';
                document.body.style.overflow = 'auto';
                console.log('🔚 Modal de error cerrado');
            }
        };

        // Función para cerrar modal
        function cerrarModal() {
            const modal = document.getElementById('modalDetalleOferta');
            if (modal) {
                modal.style.display = 'none';
                document.body.style.overflow = 'auto'; // Restaurar scroll
                console.log('🔚 Modal cerrado');
            }
        }

        // Función auxiliar para formatear fechas
        function formatearFecha(fecha) {
            if (!fecha) return null;
            try {
                if (Array.isArray(fecha) && fecha.length >= 3) {
                    // Si es array [año, mes, día] - formato que devuelve LocalDate en JSON
                    const [año, mes, dia] = fecha;
                    const fechaObj = new Date(año, mes - 1, dia); // mes - 1 porque Date usa índice 0
                    return fechaObj.toLocaleDateString('es-ES', {
                        day: '2-digit',
                        month: '2-digit',  
                        year: 'numeric'
                    });
                } else if (typeof fecha === 'string') {
                    // Si es string, asumimos formato ISO (yyyy-mm-dd)
                    return new Date(fecha + 'T00:00:00').toLocaleDateString('es-ES', {
                        day: '2-digit',
                        month: '2-digit',
                        year: 'numeric'
                    });
                } else if (fecha instanceof Date) {
                    return fecha.toLocaleDateString('es-ES', {
                        day: '2-digit',
                        month: '2-digit',
                        year: 'numeric'
                    });
                }
                return null;
            } catch (e) {
                console.error('Error formateando fecha:', e, fecha);
                return null;
            }
        }

        // Cerrar modal al hacer clic fuera
        window.onclick = function(event) {
            const modal = document.getElementById('modalDetalleOferta');
            if (event.target === modal) {
                cerrarModal();
            }
        };

        console.log('✅ Funciones del modal de detalle inicializadas');
        
        // ================= FUNCIÓN PARA MODIFICAR OFERTA =================
        
        // Variable global para rastrear si está en modo edición
        let modoEdicion = false;
        let idOfertaModificar = null;
        
        /**
         * Función para modificar una oferta académica
         */
        window.modificarOferta = function(idOferta, nombreOferta) {
            console.log('🔄 Iniciando modificación de oferta:', idOferta, nombreOferta);
            
            // Mostrar confirmación
            if (confirm(`¿Estás seguro que quieres modificar la oferta "${nombreOferta}"?`)) {
                console.log('✅ Usuario confirmó modificación');
                
                // Activar modo edición
                modoEdicion = true;
                idOfertaModificar = idOferta;
                
                // Cambiar el texto del botón submit
                const btnSubmit = document.getElementById('btn-submit-form');
                const btnSubmitText = document.getElementById('btn-submit-text');
                if (btnSubmit && btnSubmitText) {
                    btnSubmitText.textContent = 'Guardar Modificaciones';
                    btnSubmit.classList.add('btn-update');
                }
                
                // Cargar datos de la oferta
                cargarDatosOferta(idOferta);
                
                // Mostrar el formulario
                mostrarFormulario();
                
            } else {
                console.log('❌ Usuario canceló modificación');
            }
        };
        
        /**
         * Función para cargar los datos de una oferta en el formulario
         */
        function cargarDatosOferta(idOferta) {
            console.log('📥 Cargando datos de la oferta:', idOferta);
            
            fetch(`/admin/ofertas/${idOferta}`)
                .then(response => response.json())
                .then(data => {
                    console.log('📋 Respuesta del servidor:', data);
                    
                    if (data.success) {
                        poblarFormulario(data.oferta);
                    } else {
                        console.error('❌ Error al cargar datos:', data.message);
                        alert('Error al cargar los datos de la oferta: ' + data.message);
                    }
                })
                .catch(error => {
                    console.error('❌ Error en la petición:', error);
                    alert('Error de conexión al cargar los datos de la oferta');
                });
        }
        
        /**
         * Función para poblar el formulario con los datos de la oferta
         */
        function poblarFormulario(oferta) {
            console.log('📝 Poblando formulario con datos:', oferta);
            
            try {
                // Establecer ID de la oferta para modificar
                if (document.getElementById('idOfertaModificar')) {
                    document.getElementById('idOfertaModificar').value = oferta.id || oferta.idOferta || '';
                }
                
                // Datos básicos (usando los IDs reales del formulario)
                if (document.getElementById('nombre')) {
                    document.getElementById('nombre').value = oferta.nombre || '';
                }
                if (document.getElementById('descripcion')) {
                    document.getElementById('descripcion').value = oferta.descripcion || '';
                }
                if (document.getElementById('tipoOferta')) {
                    document.getElementById('tipoOferta').value = oferta.tipo || oferta.tipoOferta || '';
                }
                if (document.getElementById('modalidad')) {
                    document.getElementById('modalidad').value = oferta.modalidad || '';
                }
                if (document.getElementById('fechaInicio')) {
                    document.getElementById('fechaInicio').value = oferta.fechaInicio || '';
                }
                if (document.getElementById('fechaFin')) {
                    document.getElementById('fechaFin').value = oferta.fechaFin || '';
                }
                if (document.getElementById('cupos')) {
                    document.getElementById('cupos').value = oferta.cupos || '';
                }
                
                // Certificado - manejar diferentes formatos
                const certificadoField = document.getElementById('otorgaCertificado');
                if (certificadoField && oferta.certificado !== undefined) {
                    if (typeof oferta.certificado === 'string') {
                        certificadoField.checked = oferta.certificado === 'true' || oferta.certificado === 'SI';
                    } else {
                        certificadoField.checked = oferta.certificado === true;
                    }
                }
                
                // Mostrar campos específicos según el tipo
                mostrarCamposEspecificos(oferta.tipo || oferta.tipoOferta);
                
                // Campos específicos según el tipo
                const tipoOferta = oferta.tipo || oferta.tipoOferta;
                if (tipoOferta === 'CURSO') {
                    if (document.getElementById('costoCuota')) document.getElementById('costoCuota').value = oferta.costoCuota || '';
                    if (document.getElementById('costoMora')) document.getElementById('costoMora').value = oferta.costoMora || '';
                    if (document.getElementById('nrCuotas')) document.getElementById('nrCuotas').value = oferta.nrCuotas || '';
                    if (document.getElementById('diaVencimiento')) document.getElementById('diaVencimiento').value = oferta.diaVencimiento || '';
                    
                } else if (tipoOferta === 'FORMACION') {
                    if (document.getElementById('costoCuotaFormacion')) document.getElementById('costoCuotaFormacion').value = oferta.costoCuota || '';
                    if (document.getElementById('costoMoraFormacion')) document.getElementById('costoMoraFormacion').value = oferta.costoMora || '';
                    if (document.getElementById('nrCuotasFormacion')) document.getElementById('nrCuotasFormacion').value = oferta.nrCuotas || '';
                    if (document.getElementById('diaVencimientoFormacion')) document.getElementById('diaVencimientoFormacion').value = oferta.diaVencimiento || '';
                    
                } else if (tipoOferta === 'CHARLA') {
                    if (document.getElementById('costoInscripcionCharla')) document.getElementById('costoInscripcionCharla').value = oferta.costoInscripcion || oferta.costo || '';
                    
                } else if (tipoOferta === 'SEMINARIO') {
                    if (document.getElementById('costoInscripcionSeminario')) document.getElementById('costoInscripcionSeminario').value = oferta.costoInscripcion || oferta.costo || '';
                }
                
                // TODO: Cargar categorías
                // TODO: Mostrar imagen existente si la hay
                
                console.log('✅ Formulario poblado exitosamente');
                
            } catch (error) {
                console.error('❌ Error poblando formulario:', error);
                alert('Error al cargar los datos en el formulario: ' + error.message);
            }
        }
        
        /**
         * Función para mostrar el formulario
         */
        function mostrarFormulario() {
            const formContainer = document.getElementById('form-container');
            if (formContainer) {
                formContainer.style.display = 'block';
                formContainer.classList.add('show');
                
                // Scroll hasta el formulario
                formContainer.scrollIntoView({ behavior: 'smooth' });
            }
        }
        
        /**
         * Función para resetear el modo edición
         */
        function resetearModoEdicion() {
            modoEdicion = false;
            idOfertaModificar = null;
            
            // Resetear el botón submit
            const btnSubmit = document.getElementById('btn-submit-form');
            const btnSubmitText = document.getElementById('btn-submit-text');
            if (btnSubmit && btnSubmitText) {
                btnSubmitText.textContent = 'Registrar Oferta';
                btnSubmit.classList.remove('btn-update');
            }
            
            // Limpiar ID de oferta
            document.getElementById('idOfertaModificar').value = '';
        }
        
        // Modificar la función de envío del formulario para manejar actualizaciones
        const formularioOriginal = document.getElementById('oferta-form');
        if (formularioOriginal) {
            // Interceptar el envío del formulario
            formularioOriginal.addEventListener('submit', function(e) {
                e.preventDefault();
                
                if (modoEdicion) {
                    console.log('📤 Enviando actualización de oferta');
                    enviarActualizacionOferta();
                } else {
                    console.log('📤 Enviando nueva oferta');
                    enviarFormularioAjax(); // Función existente para crear
                }
            });
        }
        
        /**
         * Función para enviar actualización de oferta
         */
        function enviarActualizacionOferta() {
            console.log('🚀 Iniciando actualización de oferta');
            
            const formulario = document.getElementById('oferta-form');
            const formData = new FormData(formulario);
            
            // Agregar el ID de la oferta
            formData.append('idOferta', idOfertaModificar);
            
            // Mostrar loading
            const btnSubmit = document.getElementById('btn-submit-form');
            const textoOriginal = btnSubmit.innerHTML;
            btnSubmit.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Actualizando...';
            btnSubmit.disabled = true;
            
            fetch('/admin/ofertas/modificar', {
                method: 'POST',
                body: formData
            })
            .then(response => response.json())
            .then(data => {
                console.log('📋 Respuesta del servidor:', data);
                
                if (data.success) {
                    console.log('✅ Oferta actualizada exitosamente');
                    mostrarNotificacion('Oferta actualizada exitosamente', 'success');
                    
                    // Limpiar formulario y resetear modo
                    limpiarFormularioCompleto();
                    resetearModoEdicion();
                    cerrarFormulario();
                    
                    // Recargar la tabla
                    actualizarTablaOfertas();
                    
                } else {
                    console.error('❌ Error al actualizar:', data.message);
                    mostrarNotificacion('Error al actualizar la oferta: ' + data.message, 'error');
                }
            })
            .catch(error => {
                console.error('❌ Error en la petición:', error);
                mostrarNotificacion('Error de conexión al actualizar la oferta', 'error');
            })
            .finally(() => {
                // Restaurar botón
                btnSubmit.innerHTML = textoOriginal;
                btnSubmit.disabled = false;
            });
        }
        
        // Resetear modo edición al cancelar formulario
        const btnCancelForm = document.getElementById('btn-cancel-form');
        if (btnCancelForm) {
            btnCancelForm.addEventListener('click', function() {
                resetearModoEdicion();
            });
        }
        
        console.log('🔄 Sistema de modificación de ofertas inicializado');
    </script>

</body>
</html>