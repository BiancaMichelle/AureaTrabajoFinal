<!DOCTYPE html>
<html lang="es" xmlns:th="http://www.thymeleaf.org" th:replace="~{layout/adminBase :: layout(~{::title}, ~{::main})}">
<head>
    <title>Gestión de Ofertas Académicas</title>
</head>
<body>
<main class="main-content">
    <header class="main-header">
        <h1><i class="fas fa-graduation-cap"></i> Gestión de Ofertas Académicas</h1>
        <div class="header-actions">
            <button id="btn-show-form" class="btn-primary">
                <i class="fas fa-plus-circle"></i> Nueva Oferta
            </button>
        </div>
    </header>

    <!-- Formulario de Registro (colapsable) -->
    <div id="form-container" class="form-container" style="display: none;">
        <div class="form-card">
            <div class="form-header">
                <h3><i class="fas fa-plus-circle"></i> Registrar Nueva Oferta Académica</h3>
                <button type="button" id="btn-close-form" class="btn-close">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            
            <form th:action="@{/admin/ofertas/registrar}" method="post" id="oferta-form" enctype="multipart/form-data">
                <div class="form-content">
                    <!-- Columna Izquierda: Campos principales -->
                    <div class="form-left-column">
                        <!-- Datos Básicos -->
                        <div class="form-section">
                            <h4><i class="fas fa-info-circle"></i> Información Básica</h4>
                            <div class="form-grid">
                                <div class="form-group">
                                    <label for="tipoOferta">Tipo de Oferta *</label>
                                    <select id="tipoOferta" name="tipoOferta" required class="form-control">
                                        <option value="">Seleccione un tipo</option>
                                        <option value="CURSO">Curso</option>
                                        <option value="FORMACION">Formación Profesional</option>
                                        <option value="SEMINARIO">Seminario</option>
                                        <option value="CHARLA">Charla</option>
                                    </select>
                                </div>
                                <div class="form-group">
                                    <label for="nombre">Nombre de la Oferta *</label>
                                    <input type="text" id="nombre" name="nombre" required class="form-control" 
                                           placeholder="Ej: Curso de Programación Java">
                                </div>
                                <div class="form-group">
                                    <label for="modalidad">Modalidad *</label>
                                    <select id="modalidad" name="modalidad" required class="form-control">
                                        <option value="">Seleccione modalidad</option>
                                        <option value="PRESENCIAL">Presencial</option>
                                        <option value="ONLINE">Online</option>
                                        <option value="HIBRIDA">Híbrida</option>
                                    </select>
                                </div>
                                <div class="form-group">
                                    <label for="cupos">Cantidad de Cupos</label>
                                    <input type="number" id="cupos" name="cupos" class="form-control" min="1" 
                                           placeholder="Número máximo de estudiantes">
                                </div>
                                <div class="form-group">
                                    <label for="fechaInicio">Fecha de Inicio</label>
                                    <input type="date" id="fechaInicio" name="fechaInicio" class="form-control">
                                </div>
                                <div class="form-group">
                                    <label for="fechaFin">Fecha de Fin</label>
                                    <input type="date" id="fechaFin" name="fechaFin" class="form-control">
                                </div>
                            </div>
                            
                            <div class="form-group">
                                <label for="descripcion">Descripción *</label>
                                <textarea id="descripcion" name="descripcion" rows="3" required class="form-control" 
                                          placeholder="Descripción detallada de la oferta académica"></textarea>
                            </div>
                        </div>

                        <!-- Costos -->
                        <div class="form-section">
                            <h4><i class="fas fa-dollar-sign"></i> Información de Costos</h4>
                            <div class="form-grid">
                                <div class="form-group">
                                    <label for="costoInscripcion">Costo de Inscripción</label>
                                    <input type="number" step="0.01" id="costoInscripcion" name="costoInscripcion" 
                                           class="form-control" placeholder="0.00">
                                </div>
                                <div class="form-group" id="grupo-costo-cuota" style="display: none;">
                                    <label for="costoCuota">Costo por Cuota</label>
                                    <input type="number" step="0.01" id="costoCuota" name="costoCuota" 
                                           class="form-control" placeholder="0.00">
                                </div>
                                <div class="form-group" id="grupo-nro-cuotas" style="display: none;">
                                    <label for="nrCuotas">Número de Cuotas</label>
                                    <input type="number" id="nrCuotas" name="nrCuotas" class="form-control" min="1">
                                </div>
                                <div class="form-group" id="grupo-costo-mora" style="display: none;">
                                    <label for="costoMora">Costo por Mora</label>
                                    <input type="number" step="0.01" id="costoMora" name="costoMora" 
                                           class="form-control" placeholder="0.00">
                                </div>
                                <div class="form-group" id="grupo-dia-vencimiento" style="display: none;">
                                    <label for="diaVencimiento">Día de Vencimiento</label>
                                    <input type="number" id="diaVencimiento" name="diaVencimiento" 
                                           class="form-control" min="1" max="29" 
                                           placeholder="Ingrese día del mes (1-29)">
                                    <small class="form-text text-muted">
                                        <i class="fas fa-info-circle"></i>
                                        Día límite para pago sin mora (1-29). Después de esta fecha se aplicará el recargo por mora.
                                    </small>
                                </div>
                            </div>
                        </div>

                        <!-- Certificación -->
                        <div class="form-section">
                            <h4><i class="fas fa-certificate"></i> Certificación</h4>
                            <div class="checkbox-container">
                                <label class="checkbox-label">
                                    <input type="checkbox" id="otorgaCertificado" name="otorgaCertificado" class="form-checkbox">
                                    <span class="checkmark"></span>
                                    Otorga Certificado
                                </label>
                            </div>
                            
                            <div id="certificado-fields" style="display: none;">
                                <div class="form-group">
                                    <label for="tituloCertificado">Título del Certificado</label>
                                    <input type="text" id="tituloCertificado" name="tituloCertificado" class="form-control" 
                                           placeholder="Ej: Certificado de Finalización en...">
                                </div>
                                <div class="form-group">
                                    <label for="descripcionCertificado">Descripción del Certificado</label>
                                    <textarea id="descripcionCertificado" name="descripcionCertificado" rows="2" 
                                              class="form-control" placeholder="Descripción que aparecerá en el certificado"></textarea>
                                </div>
                            </div>
                        </div>

                        <!-- Categorías -->
                        <div class="form-section">
                            <div class="categoria-header">
                                <h4><i class="fas fa-tags"></i> Categorías</h4>
                                <button type="button" id="btn-gestionar-categorias" class="btn-secondary btn-sm">
                                    <i class="fas fa-cog"></i> Gestionar Categorías
                                </button>
                            </div>
                            <div class="form-group">
                                <label for="categoria-select">Seleccionar Categorías</label>
                                <p class="field-description">Seleccione una o más categorías que describan esta oferta académica</p>
                                <select id="categoria-select" class="form-control categoria-select">
                                    <option value="">-- Seleccione una categoría --</option>
                                    <!-- Las categorías se cargarán dinámicamente desde la base de datos -->
                                </select>
                                <div class="selected-categories" id="selected-categories">
                                    <span class="selected-label">Categorías seleccionadas:</span>
                                    <div class="selected-chips" id="selected-chips">
                                        <!-- Las categorías seleccionadas aparecerán aquí como chips -->
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Horarios -->
                        <div class="form-section">
                            <h4><i class="fas fa-clock"></i> Horarios</h4>
                            <div class="horarios-container">
                                <div class="horario-controls">
                                    <div class="form-grid-3">
                                        <div class="form-group">
                                            <label for="dia-semana">Día</label>
                                            <select id="dia-semana" class="form-control">
                                                <option value="">Seleccionar día</option>
                                                <option value="LUNES">Lunes</option>
                                                <option value="MARTES">Martes</option>
                                                <option value="MIERCOLES">Miércoles</option>
                                                <option value="JUEVES">Jueves</option>
                                                <option value="VIERNES">Viernes</option>
                                                <option value="SABADO">Sábado</option>
                                                <option value="DOMINGO">Domingo</option>
                                            </select>
                                        </div>
                                        <div class="form-group">
                                            <label for="hora-desde">Desde</label>
                                            <input type="time" id="hora-desde" class="form-control">
                                        </div>
                                        <div class="form-group">
                                            <label for="hora-hasta">Hasta</label>
                                            <input type="time" id="hora-hasta" class="form-control">
                                        </div>
                                    </div>
                                    <button type="button" id="btn-add-horario" class="btn-secondary">
                                        <i class="fas fa-plus"></i> Agregar Horario
                                    </button>
                                </div>
                                
                                <div class="horarios-table-container">
                                    <table id="horarios-table" class="data-table">
                                        <thead>
                                            <tr>
                                                <th>Día</th>
                                                <th>Horario</th>
                                                <th>Acción</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            <!-- Horarios dinámicos -->
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Columna Derecha: Imagen y campos específicos -->
                    <div class="form-right-column">
                        <!-- Imagen de presentación -->
                        <div class="form-section">
                            <h4><i class="fas fa-image"></i> Imagen de Presentación</h4>
                            <div class="image-upload-container">
                                <input type="file" id="imagen" name="imagen" accept="image/*" class="image-input">
                                <label for="imagen" class="image-upload-area">
                                    <div class="upload-placeholder">
                                        <i class="fas fa-cloud-upload-alt"></i>
                                        <p>Subir imagen</p>
                                        <span>JPG, PNG, GIF hasta 5MB</span>
                                    </div>
                                    <img id="image-preview" style="display: none;" alt="Vista previa">
                                </label>
                            </div>
                        </div>

                        <!-- Campos específicos por tipo de oferta -->
                        
                        <!-- Campos para CURSO -->
                        <div id="fields-curso" class="form-section tipo-specific" style="display: none;">
                            <h4><i class="fas fa-book"></i> Información del Curso</h4>
                            <div class="form-group">
                                <label for="planEstudio">Plan de Estudio</label>
                                <textarea id="planEstudio" name="planEstudio" rows="4" class="form-control" 
                                          placeholder="Detalle del plan de estudios del curso"></textarea>
                            </div>
                            <div class="form-group">
                                <label for="temario">Temario</label>
                                <textarea id="temario" name="temario" rows="4" class="form-control" 
                                          placeholder="Temario detallado del curso"></textarea>
                            </div>
                            <div class="form-group">
                                <label for="requisitos">Requisitos Previos</label>
                                <textarea id="requisitos" name="requisitos" rows="2" class="form-control" 
                                          placeholder="Conocimientos o cursos previos necesarios"></textarea>
                            </div>
                            
                            <!-- Docentes a cargo -->
                            <div class="docentes-section">
                                <h5>Docentes a Cargo</h5>
                                <div class="docente-search-container">
                                    <input type="text" id="docente-search" placeholder="Buscar docente..." 
                                           class="form-control">
                                    <div id="docente-results" class="search-results"></div>
                                </div>
                                <div class="docentes-list">
                                    <table id="docentes-table" class="mini-table">
                                        <thead>
                                            <tr>
                                                <th>Docente</th>
                                                <th>Especialidad</th>
                                                <th>Acción</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            <!-- Docentes asignados -->
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>

                        <!-- Campos para FORMACIÓN PROFESIONAL -->
                        <div id="fields-formacion" class="form-section tipo-specific" style="display: none;">
                            <h4><i class="fas fa-graduation-cap"></i> Formación Profesional</h4>
                            <div class="form-group">
                                <label for="planFormacion">Plan de Formación</label>
                                <textarea id="planFormacion" name="planFormacion" rows="4" class="form-control" 
                                          placeholder="Plan detallado de la formación profesional"></textarea>
                            </div>
                            <div class="form-group">
                                <label for="temarioFormacion">Temario</label>
                                <textarea id="temarioFormacion" name="temarioFormacion" rows="4" class="form-control" 
                                          placeholder="Temario de la formación"></textarea>
                            </div>
                            <div class="form-group">
                                <label for="estructuraModular">Estructura Modular</label>
                                <textarea id="estructuraModular" name="estructuraModular" rows="4" class="form-control" 
                                          placeholder="Descripción de los módulos que componen la formación"></textarea>
                            </div>
                            <div class="form-group">
                                <label for="requisitosFormacion">Requisitos</label>
                                <textarea id="requisitosFormacion" name="requisitosFormacion" rows="2" class="form-control" 
                                          placeholder="Requisitos para ingresar a la formación"></textarea>
                            </div>
                            
                            <!-- Docentes para formación también -->
                            <div class="docentes-section">
                                <h5>Docentes a Cargo</h5>
                                <div class="docente-search-container">
                                    <input type="text" id="docente-search-formacion" placeholder="Buscar docente..." 
                                           class="form-control">
                                    <div id="docente-results-formacion" class="search-results"></div>
                                </div>
                                <div class="docentes-list">
                                    <table id="docentes-table-formacion" class="mini-table">
                                        <thead>
                                            <tr>
                                                <th>Docente</th>
                                                <th>Especialidad</th>
                                                <th>Acción</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            <!-- Docentes asignados -->
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>

                        <!-- Campos para CHARLA -->
                        <div id="fields-charla" class="form-section tipo-specific" style="display: none;">
                            <h4><i class="fas fa-microphone"></i> Información de la Charla</h4>
                            <div class="form-group">
                                <label for="disertantesCharla">Disertantes</label>
                                <input type="text" id="disertantesCharla" name="disertantesCharla" class="form-control" 
                                       placeholder="Nombres de los disertantes separados por coma">
                            </div>
                            <div class="form-group">
                                <label for="duracionEstimada">Duración Estimada</label>
                                <input type="text" id="duracionEstimada" name="duracionEstimada" class="form-control" 
                                       placeholder="Ej: 2 horas, 90 minutos">
                            </div>
                            <div class="form-group">
                                <label for="publicoObjetivo">Público Objetivo</label>
                                <input type="text" id="publicoObjetivo" name="publicoObjetivo" class="form-control" 
                                       placeholder="A quién está dirigida la charla">
                            </div>
                            <div class="form-group">
                                <label for="lugarCharla">Lugar o Enlace</label>
                                <input type="text" id="lugarCharla" name="lugarCharla" class="form-control" 
                                       placeholder="Dirección física o enlace de acceso">
                            </div>
                            <div class="form-group">
                                <label for="materialesApoyo">Materiales de Apoyo</label>
                                <textarea id="materialesApoyo" name="materialesApoyo" rows="2" class="form-control" 
                                          placeholder="Descripción de materiales que se proporcionarán"></textarea>
                            </div>
                        </div>

                        <!-- Campos para SEMINARIO -->
                        <div id="fields-seminario" class="form-section tipo-specific" style="display: none;">
                            <h4><i class="fas fa-users"></i> Información del Seminario</h4>
                            <div class="form-group">
                                <label for="disertantesSeminario">Disertantes</label>
                                <input type="text" id="disertantesSeminario" name="disertantesSeminario" class="form-control" 
                                       placeholder="Nombres de los disertantes separados por coma">
                            </div>
                            <div class="form-group">
                                <label for="fechaSeminario">Fecha del Seminario</label>
                                <input type="date" id="fechaSeminario" name="fechaSeminario" class="form-control">
                            </div>
                            <div class="form-group">
                                <label for="horaSeminario">Hora del Seminario</label>
                                <input type="time" id="horaSeminario" name="horaSeminario" class="form-control">
                            </div>
                            <div class="form-group">
                                <label for="duracionSeminario">Duración Estimada</label>
                                <input type="text" id="duracionSeminario" name="duracionSeminario" class="form-control" 
                                       placeholder="Ej: 4 horas, medio día">
                            </div>
                            <div class="form-group">
                                <label for="requisitosParticipacion">Requisitos de Participación</label>
                                <textarea id="requisitosParticipacion" name="requisitosParticipacion" rows="2" 
                                          class="form-control" placeholder="Requisitos para participar (opcional)"></textarea>
                            </div>
                            <div class="form-group">
                                <label for="lugarSeminario">Lugar o Enlace</label>
                                <input type="text" id="lugarSeminario" name="lugarSeminario" class="form-control" 
                                       placeholder="Dirección física o enlace de acceso">
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="form-actions">
                    <button type="submit" class="btn-submit">
                        <i class="fas fa-save"></i> Registrar Oferta
                    </button>
                    <button type="button" id="btn-cancel-form" class="btn-cancel">
                        <i class="fas fa-times"></i> Cancelar
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- Sección de Filtros y Tabla -->
    <div class="ofertas-table-section">
        <div class="filters-section">
            <div class="filters-header">
                <h3><i class="fas fa-filter"></i> Filtros y Búsqueda</h3>
            </div>
            <div class="filters-content">
                <div class="search-container">
                    <div class="search-input-container">
                        <input type="text" id="search-input" placeholder="Buscar por nombre de oferta..." class="search-input">
                        <i class="fas fa-search search-icon"></i>
                    </div>
                </div>
                <div class="filters-grid">
                    <select id="filtro-tipo" class="filter-select">
                        <option value="">Todos los tipos</option>
                        <option value="CURSO">Curso</option>
                        <option value="FORMACION">Formación</option>
                        <option value="SEMINARIO">Seminario</option>
                        <option value="CHARLA">Charla</option>
                    </select>
                    <select id="filtro-modalidad" class="filter-select">
                        <option value="">Todas las modalidades</option>
                        <option value="PRESENCIAL">Presencial</option>
                        <option value="ONLINE">Online</option>
                        <option value="HIBRIDA">Híbrida</option>
                    </select>
                    <select id="filtro-estado" class="filter-select">
                        <option value="">Todos los estados</option>
                        <option value="ACTIVA">Activa</option>
                        <option value="INACTIVA">Inactiva</option>
                        <option value="FINALIZADA">Finalizada</option>
                    </select>
                    <select id="filtro-certificado" class="filter-select">
                        <option value="">Certificado</option>
                        <option value="SI">Con certificado</option>
                        <option value="NO">Sin certificado</option>
                    </select>
                    <input type="number" id="filtro-costo-min" placeholder="Costo mínimo" class="filter-input">
                    <input type="number" id="filtro-costo-max" placeholder="Costo máximo" class="filter-input">
                </div>
                <div class="filters-actions">
                    <button id="btn-apply-filters" class="btn-secondary">
                        <i class="fas fa-search"></i> Aplicar Filtros
                    </button>
                    <button id="btn-clear-filters" class="btn-outline">
                        <i class="fas fa-times"></i> Limpiar
                    </button>
                </div>
            </div>
        </div>

        <div class="table-section">
            <div class="table-header">
                <h3><i class="fas fa-list"></i> Lista de Ofertas Académicas</h3>
                <div class="table-stats">
                    <span class="stats-text">Total: <strong id="total-ofertas">1</strong> ofertas</span>
                </div>
            </div>
            
            <div class="table-container">
                <table id="ofertas-table" class="data-table">
                    <thead>
                        <tr>
                            <th>ID</th>
                            <th>Nombre</th>
                            <th>Tipo</th>
                            <th>Modalidad</th>
                            <th>Cupos</th>
                            <th>Fecha Inicio</th>
                            <th>Costo</th>
                            <th>Certificado</th>
                            <th>Estado</th>
                            <th>Acciones</th>
                        </tr>
                    </thead>
                    <tbody>
                        <!-- Ejemplo de datos -->
                        <tr>
                            <td>001</td>
                            <td>Curso de Java Avanzado</td>
                            <td><span class="status-badge status-curso">CURSO</span></td>
                            <td><span class="status-badge status-online">ONLINE</span></td>
                            <td>25</td>
                            <td>15/10/2025</td>
                            <td>$1,500</td>
                            <td><i class="fas fa-check-circle text-success"></i></td>
                            <td><span class="status-badge status-activa">ACTIVA</span></td>
                            <td class="actions">
                                <button class="btn-icon btn-edit" title="Editar">
                                    <i class="fas fa-edit"></i>
                                </button>
                                <button class="btn-icon btn-view" title="Ver detalles">
                                    <i class="fas fa-eye"></i>
                                </button>
                                <button class="btn-icon btn-delete" title="Eliminar">
                                    <i class="fas fa-trash"></i>
                                </button>
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>
            
            <div class="table-pagination">
                <div class="pagination-info">
                    Mostrando 1-1 de 1 ofertas
                </div>
                <div class="pagination-controls">
                    <button class="btn-pagination" disabled>
                        <i class="fas fa-chevron-left"></i> Anterior
                    </button>
                    <span class="pagination-pages">
                        <button class="btn-page active">1</button>
                    </span>
                    <button class="btn-pagination" disabled>
                        Siguiente <i class="fas fa-chevron-right"></i>
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal de Gestión de Categorías -->
    <div id="categoriaModal" class="modal-overlay" style="display: none;">
        <div class="modal-content modal-lg">
            <div class="modal-header">
                <h3 id="categoriaModalLabel">Gestión de Categorías</h3>
                <button type="button" class="btn-close" aria-label="Cerrar">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            
            <div class="modal-body">
                <!-- Alertas -->
                <div id="categoriaAlert"></div>
                
                <!-- Sección para agregar nueva categoría -->
                <div class="categoria-form-section">
                    <h4><i class="fas fa-plus"></i> Nueva Categoría</h4>
                    <form id="categoriaForm">
                        <input type="hidden" id="categoriaId" name="categoriaId">
                        
                        <div class="form-group">
                            <label for="categoriaNombre">
                                <i class="fas fa-tag"></i> Nombre de la Categoría *
                            </label>
                            <input type="text" 
                                   id="categoriaNombre" 
                                   name="categoriaNombre" 
                                   class="form-control" 
                                   placeholder="Ej: Tecnología, Idiomas, Arte..."
                                   maxlength="100"
                                   required>
                            <small class="form-text text-muted">Entre 2 y 100 caracteres</small>
                        </div>
                        
                        <div class="form-group">
                            <label for="categoriaDescripcion">
                                <i class="fas fa-align-left"></i> Descripción *
                            </label>
                            <textarea id="categoriaDescripcion" 
                                      name="categoriaDescripcion" 
                                      class="form-control" 
                                      rows="3"
                                      placeholder="Descripción detallada de la categoría..."
                                      maxlength="500"
                                      required></textarea>
                            <small class="form-text text-muted">Entre 5 y 500 caracteres</small>
                        </div>
                        
                        <div class="form-actions">
                            <button type="button" id="btnGuardarCategoria" class="btn btn-primary">
                                <i class="fas fa-save"></i> Crear Categoría
                            </button>
                            <button type="button" id="btnCancelarCategoria" class="btn btn-secondary">
                                <i class="fas fa-times"></i> Cancelar
                            </button>
                        </div>
                    </form>
                </div>
                
                <!-- Separador -->
                <hr class="modal-separator">
                
                <!-- Sección de categorías existentes -->
                <div class="categorias-table-section">
                    <div class="table-header">
                        <h4><i class="fas fa-list"></i> Categorías Existentes</h4>
                        <div class="table-stats">
                            <span id="contadorCategorias">Total: 0 categorías</span>
                        </div>
                    </div>
                    
                    <!-- Loading y error messages -->
                    <div id="categoriasLoading" class="text-center" style="display: none;">
                        <i class="fas fa-spinner fa-spin"></i> Cargando categorías...
                    </div>
                    <div id="categoriasError" class="alert alert-danger" style="display: none;"></div>
                    
                    <!-- Tabla de categorías -->
                    <div class="table-responsive">
                        <table id="categoriasTable" class="table table-striped">
                            <thead class="table-dark">
                                <tr>
                                    <th>Nombre</th>
                                    <th>Descripción</th>
                                    <th>Fecha Creación</th>
                                    <th width="120">Acciones</th>
                                </tr>
                            </thead>
                            <tbody>
                                <!-- Las categorías se cargan dinámicamente -->
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script th:src="@{/js/gestionOfertas.js}"></script>
    <script th:src="@{/js/categorias.js}"></script>
    <script th:src="@{/js/categoria-debug.js}"></script>
</main>
</body>
</html>