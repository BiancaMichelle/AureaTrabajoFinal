<!-- Fragmento para la ventana modal de autenticación -->
<div th:fragment="auth-modal" id="authModal" class="auth-modal-overlay">

    <div class="auth-modal-container">
        <!-- Lado Izquierdo - Decorativo -->
        <div class="auth-modal-left">
            <div class="brand-container">
                <h2>Aurea</h2>
                <p>Tu plataforma de aprendizaje</p>
            </div>
        </div>

        <!-- Lado Derecho - Formularios -->
        <div class="auth-modal-right">
            <span class="close-modal" onclick="closeAuthModal()">&times;</span>

            <!-- Contenedor de Formularios (para el efecto de deslizamiento) -->
            <div class="forms-container">
                <!-- Formulario de Login -->
                <div class="form-wrapper" id="login-form">
                    <h3>Iniciar Sesión</h3>
                    <form th:action="@{/perform_login}" method="post">
                        <input type="hidden"
                            th:name="${_csrf.parameterName}"
                            th:value="${_csrf.token}"/>
                        <div class="input-group">
                            <label for="login-dni">DNI</label>
                            <input type="text" id="login-dni" name="username" required>
                        </div>
                        <div class="input-group">
                            <label for="login-password">Contraseña</label>
                            <input type="password" id="login-password" name="password" required>
                        </div>
                        <a href="#" class="forgot-password">¿Has olvidado tu contraseña?</a>
                        <button type="submit" class="auth-btn">Iniciar Sesión</button>
                    </form>
                    <p class="switch-form" id="to-register">¿No tienes una cuenta? <a href="#" onclick="toggleForms()">Regístrate</a></p>
                </div>

                <!-- Formulario de Registro -->
                <div class="form-wrapper" id="register-form" style="display: none;">
                    <h3>Registrarse</h3>
                
                    <!-- Navegación por Pasos -->
                    <div class="step-navigation">
                        <div class="step active" data-step="1">
                            <div class="step-icon">1</div>
                            <p>Datos Personales</p>
                        </div>
                        <div class="step" data-step="2">
                            <div class="step-icon">2</div>
                            <p>Domicilio</p>
                        </div>
                        <div class="step" data-step="3">
                            <div class="step-icon">3</div>
                            <p>Académicos</p>
                        </div>
                        <div class="step" data-step="4">
                            <div class="step-icon">4</div>
                            <p>Cuenta</p>
                        </div>
                    </div>
                
                    <form th:action="@{/register}" th:object="${alumno}" method="post" id="registerForm" novalidate>
                        <div class="form-scroll">
                            <div class="form-step active" data-step="1">
                                <div class="input-group">
                                    <label for="reg-nombre">Nombre</label>
                                    <input type="text" th:field="*{nombre}" id="reg-nombre" placeholder="Nombre" class="w-full px-4 py-3 bg-slate-800 border border-slate-700 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500 text-white placeholder-slate-400 transition-colors duration-200" required>
                                    <span class="error-message" th:if="${#fields.hasErrors('nombre')}" th:errors="*{nombre}"></span>
                                </div>
                                <div class="input-group">
                                    <label for="reg-apellido">Apellido</label>
                                    <input type="text" th:field="*{apellido}" id="reg-apellido" placeholder="Apellido" class="w-full px-4 py-3 bg-slate-800 border border-slate-700 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500 text-white placeholder-slate-400 transition-colors duration-200" required>
                                    <span class="error-message" th:if="${#fields.hasErrors('apellido')}" th:errors="*{apellido}"></span>
                                </div>
                                <div class="input-group">
                                    <label for="reg-dni">DNI</label>
                                    <input type="text" th:field="*{dni}" id="reg-dni" placeholder="DNI" class="w-full px-4 py-3 bg-slate-800 border border-slate-700 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500 text-white placeholder-slate-400 transition-colors duration-200" required>
                                    <span class="error-message" th:if="${#fields.hasErrors('dni')}" th:errors="*{dni}"></span>
                                </div>
                                <div class="input-group">
                                    <label for="reg-fecha-nac">Fecha de nacimiento</label>
                                    <input type="date" th:field="*{fechaNacimiento}" id="reg-fecha-nac" class="w-full px-4 py-3 bg-slate-800 border border-slate-700 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500 text-white placeholder-slate-400 transition-colors duration-200" required>
                                    <span class="error-message" th:if="${#fields.hasErrors('fechaNacimiento')}" th:errors="*{fechaNacimiento}"></span>
                                </div>
                                <div class="input-group">
                                    <label for="reg-telefono">Teléfono</label>
                                    <input type="tel" th:field="*{numTelefono}" id="reg-telefono" placeholder="Teléfono" class="w-full px-4 py-3 bg-slate-800 border border-slate-700 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500 text-white placeholder-slate-400 transition-colors duration-200" required>
                                    <span class="error-message" th:if="${#fields.hasErrors('numTelefono')}" th:errors="*{numTelefono}"></span>
                                </div>
                                <div class="input-group">
                                    <label for="reg-email">Correo electrónico</label>
                                    <input type="email" th:field="*{correo}" id="reg-email" placeholder="Correo electrónico" class="w-full px-4 py-3 bg-slate-800 border border-slate-700 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500 text-white placeholder-slate-400 transition-colors duration-200" required>
                                    <span class="error-message" th:if="${#fields.hasErrors('correo')}" th:errors="*{correo}"></span>
                                </div>
                            </div>
                
                            <!-- Paso 2: Datos de domicilio (país, provincia, ciudad y domicilio) -->
                            <div class="form-step" data-step="2">
                                <div class="input-group">
                                    <label for="reg-pais">País</label>
                                    <select id="reg-pais" th:field="*{pais.codigo}" class="w-full px-4 py-3 bg-slate-800 border border-slate-700 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500 text-white transition-colors duration-200" required>
                                        <option value="">Seleccionar país</option>
                                        <option th:each="pais : ${paises}" 
                                                th:value="${pais.codigo}" 
                                                th:text="${pais.nombre}">
                                        </option>
                                    </select>
                                    <span class="error-message" th:if="${#fields.hasErrors('pais.codigo')}" th:errors="*{pais.codigo}"></span>
                                </div>
                                <div class="input-group">
                                    <label for="reg-provincia">Provincia</label>
                                    <select id="reg-provincia" th:field="*{provincia.codigo}" class="w-full px-4 py-3 bg-slate-800 border border-slate-700 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500 text-white transition-colors duration-200" required>
                                        <option value="">Seleccionar provincia</option>
                                    </select>
                                    <span class="error-message" th:if="${#fields.hasErrors('provincia.codigo')}" th:errors="*{provincia.codigo}"></span>
                                </div>
                                <div class="input-group">
                                    <label for="reg-ciudad">Ciudad</label>
                                    <select id="reg-ciudad" th:field="*{ciudad.id}" class="w-full px-4 py-3 bg-slate-800 border border-slate-700 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500 text-white transition-colors duration-200" required>
                                        <option value="">Seleccionar ciudad</option>
                                    </select>
                                    <span class="error-message" th:if="${#fields.hasErrors('ciudad.id')}" th:errors="*{ciudad.id}"></span>
                                </div>
                                <div class="input-group">
                                    <label for="reg-domicilio">Domicilio</label>
                                    <input type="text" th:field="*{domicilio}" id="reg-domicilio" placeholder="Domicilio" class="w-full px-4 py-3 bg-slate-800 border border-slate-700 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500 text-white placeholder-slate-400 transition-colors duration-200" required>
                                    <span class="error-message" th:if="${#fields.hasErrors('domicilio')}" th:errors="*{domicilio}"></span>
                                </div>
                            </div>
                
                            <!-- Paso 3: Datos académicos (últimos estudios alcanzados, colegio de egreso, año de egreso) -->
                            <div class="form-step" data-step="3">
                                <div class="input-group">
                                    <label for="reg-estudios">Últimos estudios alcanzados</label>
                                    <input type="text" th:field="*{ultimosEstudios}" id="reg-estudios" placeholder="Últimos estudios alcanzados" class="w-full px-4 py-3 bg-slate-800 border border-slate-700 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500 text-white placeholder-slate-400 transition-colors duration-200" required>
                                    <span class="error-message" th:if="${#fields.hasErrors('ultimosEstudios')}" th:errors="*{ultimosEstudios}"></span>
                                </div>
                                <div class="input-group">
                                    <label for="reg-colegio">Colegio de egreso</label>
                                    <select th:field="*{colegioEgreso}" id="reg-colegio" class="w-full px-4 py-3 bg-slate-800 border border-slate-700 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500 text-white transition-colors duration-200" required>
                                        <option value="">Colegio de egreso</option>
                                        <option th:each="inst : ${instituciones}" th:value="${inst.id}" th:text="${inst.nombre}"></option>
                                    </select>
                                    <span class="error-message" th:if="${#fields.hasErrors('colegioEgreso')}" th:errors="*{colegioEgreso}"></span>
                                </div>
                                <div class="input-group">
                                    <label for="reg-anio-egreso">Año de egreso</label>
                                    <input type="number" th:field="*{añoEgreso}" id="reg-anio-egreso" placeholder="Año de egreso" min="1950" max="2025" class="w-full px-4 py-3 bg-slate-800 border border-slate-700 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500 text-white placeholder-slate-400 transition-colors duration-200"/>
                                    <span class="error-message" th:if="${#fields.hasErrors('añoEgreso')}" th:errors="*{añoEgreso}"></span>
                                </div>
                            </div>

                            <!-- Paso 4: Datos de la cuenta (contraseña, repetir contraseña y aceptación de términos) -->
                            <div class="form-step" data-step="4">
                                <div class="input-group">
                                    <label for="reg-password">Contraseña</label>
                                    <input type="password" th:field="*{contraseña}" id="reg-password" placeholder="Contraseña" class="w-full px-4 py-3 bg-slate-800 border border-slate-700 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500 text-white placeholder-slate-400 transition-colors duration-200" required>
                                    <span class="error-message" th:if="${#fields.hasErrors('contraseña')}" th:errors="*{contraseña}"></span>
                                </div>
                                <div class="input-group">
                                    <label for="reg-password2">Repetir contraseña</label>
                                    <input type="password" id="reg-password2" placeholder="Repetir contraseña" class="w-full px-4 py-3 bg-slate-800 border border-slate-700 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500 text-white placeholder-slate-400 transition-colors duration-200" required>
                                    <span class="error-message" id="error-password2"></span>
                                </div>
                                <div class="input-group terms-group" style="display:flex; align-items:start; gap:8px;">
                                    <input type="checkbox" id="reg-terms" class="w-4 h-4 text-indigo-600 bg-slate-700 rounded border-slate-600 focus:ring-indigo-500 mt-1" required>
                                    <label for="reg-terms" class="text-sm text-slate-300" style="margin:0;">
                                        Acepto los términos y condiciones. He leído y comprendo las políticas de privacidad y el uso de mis datos personales para fines académicos.
                                    </label>
                                </div>
                            </div>
                        </div>
                        <div class="step-actions">
                            <div class="action-group active" data-step="1">
                                <button type="button" class="auth-btn next-btn" onclick="nextStep(2)" style="width: 100%;">Siguiente</button>
                            </div>
                            <div class="action-group" data-step="2">
                                <button type="button" class="auth-btn prev-btn" onclick="prevStep(1)">Anterior</button>
                                <button type="button" class="auth-btn next-btn" onclick="nextStep(3)">Siguiente</button>
                            </div>
                            <div class="action-group" data-step="3">
                                <button type="button" class="auth-btn prev-btn" onclick="prevStep(2)">Anterior</button>
                                <button type="button" class="auth-btn next-btn" onclick="nextStep(4)">Siguiente</button>
                            </div>
                            <div class="action-group" data-step="4">
                                <button type="button" class="auth-btn prev-btn" onclick="prevStep(3)">Anterior</button>
                                <button type="submit" class="auth-btn">Registrarse</button>
                            </div>
                        </div>
                    </form>
                    <p class="switch-form" id="to-login">¿Ya tienes una cuenta? <a href="#" onclick="toggleForms()">Inicia Sesión</a></p>
                </div>
            </div>
        </div>
    </div>
</div>

