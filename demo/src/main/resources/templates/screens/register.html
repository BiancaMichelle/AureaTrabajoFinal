<!DOCTYPE html>
<html lang="es"
      xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{layout/base}">
<head>
  <meta charset="UTF-8">
  <title>Registro Alumno</title>
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
        rel="stylesheet" />
  <link rel="stylesheet" th:href="@{/style/stylesheet.css}" />
    <link rel="stylesheet" th:href="@{/style/auth.css}" />
  <script th:src="@{/js/register.js}"></script>
</head>
<body>
<div layout:fragment="content">
    <div class="auth-container">
        <!-- Lado izquierdo: branding + partículas -->
        <div class="auth-left">
            <h1 class="brand-logo">Aurea</h1>
            <p class="brand-subtitle">¿Ya tienes una cuenta? <a th:href="@{/login}">Inicia sesión</a></p>
            <!-- Partículas (usarán las reglas de auth.css) -->
            <div class="particle" style="width:80px;height:80px;left:10%;top:10%;"></div>
            <div class="particle" style="width:60px;height:60px;left:70%;top:20%;"></div>
            <div class="particle" style="width:40px;height:40px;left:30%;top:60%;"></div>
            <div class="particle" style="width:100px;height:100px;left:80%;top:70%;"></div>
        </div>

        <!-- Lado derecho: formulario -->
        <div class="auth-right">
            <div th:if="${mensaje}" th:classappend="${tipo == 'error'} ? 'alert alert-error' : 
                                                ${tipo == 'success'} ? 'alert alert-success' : 
                                                'alert alert-info'"
                style="margin-bottom: 20px;">
                <span th:text="${mensaje}"></span>
            </div>

            <div class="form-wrapper">
                <h1>Registro de Estudiante</h1>

                <!-- Indicador de pasos (usa auth.css) -->
                <div class="steps-indicator">
                        <div class="step-item active" data-step="1">
                                <div class="step-number">1</div>
                                <span class="step-label">Datos Personales</span>
                        </div>
                        <div class="step-item" data-step="2">
                                <div class="step-number">2</div>
                                <span class="step-label">Domicilio</span>
                        </div>
                        <div class="step-item" data-step="3">
                                <div class="step-number">3</div>
                                <span class="step-label">Datos Académicos</span>
                        </div>
                        <div class="step-item" data-step="4">
                                <div class="step-number">4</div>
                                <span class="step-label">Cuenta y Confirmación</span>
                        </div>
                </div>

        <form th:action="@{/register}" th:object="${alumno}" method="post" id="registerForm" novalidate>
        <!-- Paso 1: Datos Personales -->
        <div class="form-step" data-step="1">
            <h3>Datos Personales</h3>
            
            <div class="field-group">
                <label for="nombre">Nombre</label>
                <input type="text" id="nombre" th:field="*{nombre}" required 
                    pattern="[a-zA-ZáéíóúÁÉÍÓÚñÑ\s]+" 
                    title="Solo se permiten letras y espacios" />
            </div>
            
            <div class="field-group">
                <label for="apellido">Apellido</label>
                <input type="text" id="apellido" th:field="*{apellido}" required 
                    pattern="[a-zA-ZáéíóúÁÉÍÓÚñÑ\s]+" 
                    title="Solo se permiten letras y espacios" />
            </div>
            
            <div class="field-group">
                <label for="dni">DNI</label>
                <input type="text" id="dni" th:field="*{dni}" required 
                    pattern="[0-9]{7,8}" 
                    title="El DNI debe tener 7 u 8 dígitos" />
            </div>
            
            <div class="field-group">
                <label for="genero">Género</label>
                <select id="genero" th:field="*{genero}" required>
                    <option value="">Seleccionar género</option>
                    <option value="MASCULINO">Masculino</option>  <!-- ✅ Cambiado -->
                    <option value="FEMENINO">Femenino</option>    <!-- ✅ Cambiado -->
                    <option value="OTRO">Otro</option>            <!-- ✅ Cambiado -->
                    <option value="PREFIERO_NO_DECIR">Prefiero no decir</option> <!-- ✅ Cambiado -->
                </select>
            </div>
            
            <div class="field-group">
                <label for="fechaNacimiento">Fecha de nacimiento</label>
                <input type="date" id="fechaNacimiento" 
                       name="fechaNacimientoStr" 
                       required />
                <small>Debes tener al menos 16 años para registrarte</small>
            </div>
            
            <div class="field-group">
                <label for="telefono">Teléfono</label>
                <!-- ✅ CORREGIDO: th:field y name correcto -->
                <input type="tel" id="telefono" th:field="*{numTelefono}" 
                    placeholder="54 9376-4123456" required 
                    pattern="[\d\s\-\(\)\+]{10,}" 
                    title="Debe tener al menos 10 dígitos" />
            </div>
            
            <div class="field-group">
                <label for="email">Correo</label>
                <input type="email" id="email" th:field="*{correo}" required />
            </div>
        </div>

        <!-- Paso 2: Datos de Domicilio -->
        <div class="form-step" data-step="2" style="display:none;">
            <h3>Domicilio</h3>
            
            <!-- Campos hidden para los IDs -->
            <input type="hidden" id="paisCodigo" name="paisCodigo" />
            <input type="hidden" id="provinciaCodigo" name="provinciaCodigo" />
            <input type="hidden" id="ciudadId" name="ciudadId" />

            <div>
                <label for="pais">País</label>
                <select id="pais" required>
                    <option value="">Selecciona un país</option>
                    <option th:each="pais : ${paises}" 
                            th:value="${pais.nombre}"
                            th:attr="data-codigo=${pais.codigo}"
                            th:text="${pais.nombre}">
                    </option>
                </select>
            </div>
            
            <div>
                <label for="provincia">Provincia</label>
                <select id="provincia" required disabled>
                    <option value="">Primero selecciona un país</option>
                </select>
            </div>
            
            <div>
                <label for="ciudad">Ciudad</label>
                <select id="ciudad" required disabled>
                    <option value="">Primero selecciona una provincia</option>
                </select>
            </div>
        </div>

        <!-- Paso 3: Datos Académicos -->
        <div class="form-step" data-step="3" style="display:none;">
            <h3>Datos Académicos</h3>
            
            
            <div>
                <label for="ultimosEstudios">Últimos Estudios Alcanzados</label>
                <select id="ultimosEstudios" th:field="*{ultimosEstudios}" required>
                    <option value="">Seleccionar nivel de estudios</option>
                    <option value="secundaria-completa">Secundaria</option>
                    <option value="terciario-completo">Terciario</option>
                    <option value="universitario-completo">Universitario</option>
                    <option value="posgrado">Posgrado</option>
                </select>
            </div>
            
            <div>
            <label for="colegioEgreso">Colegio de Egreso</label>
            <!-- Usa el campo simple -->
            <input type="text" id="colegioEgreso" th:field="*{colegioEgreso}" placeholder="Nombre del colegio" required />
        </div>
            
            <div>
                <label for="añoEgreso">Año de Egreso</label>
                <input type="number" id="añoEgreso" th:field="*{añoEgreso}" placeholder="2024" min="1950" max="2030" required />
            </div>
        </div>

        <!-- Paso 4: Datos de la Cuenta y Confirmación -->
        <div class="form-step" data-step="4" style="display:none;">
            <h3>Cuenta y Confirmación</h3>
            <div>
                <label for="password">Contraseña</label>
                <input type="password" id="password" th:field="*{contraseña}" minlength="8" required />
                <small>La contraseña debe tener al menos 8 caracteres además de minuscula y mayuscula.</small>
            </div>
            <div>
                <label for="confirmPassword">Repetir Contraseña</label>
                <input type="password" id="confirmPassword" name="confirmPassword" required />
            </div>
            <div>
                <label>
                    <input type="checkbox" id="terms" name="terms" required /> Acepto los <a href="#" target="_blank">términos y condiciones</a>
                </label>
            </div>
            <div>
                <label>
                    <input type="checkbox" id="promotions" th:field="*{aceptaPromociones}" /> Deseo recibir promociones e información relevante del instituto
                </label>
            </div>
        </div>

        <!-- Botones -->
        <div class="controls text-center">
            <button type="button" class="btn" id="prevBtn">Anterior</button>
            <button type="button" class="btn" id="cancelBtn">Cancelar</button>
            <button type="button" class="btn" id="nextBtn">Siguiente</button>
            <button type="submit" class="btn" id="submitBtn" style="display:none;">Registrar</button>
        </div>



        <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}"/>
    </form>

            </div> <!-- .form-wrapper -->
        </div> <!-- .auth-right -->
    </div> <!-- .auth-container -->
</div> <!-- layout:fragment -->

</body>
</html>
